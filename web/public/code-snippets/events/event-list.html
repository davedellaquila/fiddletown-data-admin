<!-- 
  SSA Events Widget - Squarespace Code Injection
  
  This widget fetches events from a Supabase database and displays them with filtering and layout options.
  Features:
  - Fetches upcoming events from the 'events' table
  - Multiple layout options: list (by month), grid tiles
  - Keyword filtering
  - Date range filtering (from/to dates)
  - Includes caching for better performance
  - Handles loading states and error conditions
  
  Usage: Include this code in Squarespace Code Injection and it will render events in the #events-list div
-->

<!-- 1) One-time: widget script -->
<script>
(function() {
  function todayISO() { const d=new Date(); d.setHours(0,0,0,0); return d.toISOString().slice(0,10); }
  
  // Normalize date string to YYYY-MM-DD format for consistent date-only comparisons
  function normalizeDateString(dateStr) {
    if (!dateStr) return null;
    // Extract date part (YYYY-MM-DD) if timestamp format, or return as-is if already date-only
    const datePart = dateStr.split('T')[0];
    // Ensure it's in YYYY-MM-DD format (not MM/DD/YYYY or other formats)
    if (datePart.match(/^\d{4}-\d{2}-\d{2}$/)) {
      return datePart;
    }
    // If it's in a different format, try to parse and reformat
    const date = new Date(datePart);
    if (!isNaN(date.getTime())) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    return datePart; // Fallback to original if parsing fails
  }
  
  // Adjust date for PostgREST query to account for timezone boundaries
  // PostgREST may interpret date strings as UTC midnight, causing off-by-one errors
  // This function adjusts the date to ensure correct comparison
  function adjustDateForQuery(dateStr, isStartDate) {
    if (!dateStr) return null;
    const normalized = normalizeDateString(dateStr);
    if (!normalized) return null;
    
    // Parse the date in local timezone to avoid UTC conversion issues
    const [year, month, day] = normalized.split('-').map(Number);
    const localDate = new Date(year, month - 1, day);
    
    // For start date: we want events >= this date, so use the date as-is
    // For end date: we want events <= this date, so we need to include the full day
    // Add one day to the end date to ensure we include events on that date
    if (!isStartDate) {
      localDate.setDate(localDate.getDate() + 1);
    }
    
    // Format back to YYYY-MM-DD
    const adjustedYear = localDate.getFullYear();
    const adjustedMonth = String(localDate.getMonth() + 1).padStart(2, '0');
    const adjustedDay = String(localDate.getDate()).padStart(2, '0');
    return `${adjustedYear}-${adjustedMonth}-${adjustedDay}`;
  }

  // Layout types
  const LAYOUTS = {
    LIST: 'list',
    GRID: 'grid',
    CALENDAR: 'calendar'
  };

  async function fetchEvents({ url, key, from = null, to = null, limit = 200 }) {
      const api = new URL(url + '/rest/v1/events');
      api.searchParams.set('select','id,name,slug,host_org,start_date,end_date,start_time,end_time,location,website_url,image_url,recurrence,sort_order,description,is_signature_event');
      api.searchParams.set('order','start_date.asc,name.asc');
      api.searchParams.set('limit', String(limit));

	  // Show upcoming events if FROM is set.
	  // Include rows where:
	  //  - start_date >= from (events starting on or after the selected date), OR
	  //  - end_date >= from (events that span across the selected date), OR
	  //  - (both dates are null) (undated events)
	  // Handle date filters - PostgREST DATE column comparison appears to have an off-by-one issue
	  // When comparing date strings, it seems to interpret them as one day earlier
	  // Solution: Adjust dates to compensate for PostgREST's interpretation
	  
	  if (from) {
	    // Normalize date string to ensure YYYY-MM-DD format
	    const fromDateStr = normalizeDateString(from);
	    
	    // Strategy: Fetch a broad range of events to ensure we get all events that might span the filter date
	    // We'll fetch events that:
	    // 1. Start up to 60 days before the filter date (to catch long-spanning events), OR
	    // 2. End on or after the filter date (to catch events ending on/after the filter date), OR
	    // 3. Are undated (both dates null)
	    // The client-side filter will then correctly filter to only events that end on/after the filter date
	    // This approach avoids PostgREST date interpretation issues by being very permissive server-side
	    
	    // Fetch events starting up to 60 days before the filter date
	    const [startYear, startMonth, startDay] = fromDateStr.split('-').map(Number);
	    const startDateForQuery = new Date(startYear, startMonth - 1, startDay);
	    startDateForQuery.setDate(startDateForQuery.getDate() - 60); // Fetch events starting up to 60 days before filter date
	    const adjustedFromStartBefore = `${startDateForQuery.getFullYear()}-${String(startDateForQuery.getMonth() + 1).padStart(2, '0')}-${String(startDateForQuery.getDate()).padStart(2, '0')}`;
	    
	    // Also fetch events ending on or after the filter date
	    // To account for PostgREST's date interpretation, subtract one day from the filter date
	    // This ensures we fetch events ending on the filter date itself
	    const [endYear, endMonth, endDay] = fromDateStr.split('-').map(Number);
	    const endDateForQuery = new Date(endYear, endMonth - 1, endDay);
	    endDateForQuery.setDate(endDateForQuery.getDate() - 1); // Subtract one day to be more permissive
	    const adjustedFromEnd = `${endDateForQuery.getFullYear()}-${String(endDateForQuery.getMonth() + 1).padStart(2, '0')}-${String(endDateForQuery.getDate()).padStart(2, '0')}`;
	    
	    // Simplified approach: Fetch events starting 60 days before filter date
	    // This will catch events that span across the filter date
	    // Client-side filtering will then correctly filter by end_date
	    // Use start_date filter directly (simpler, avoids or() syntax issues)
	    // For undated events, we'll handle them client-side since we can't easily combine with or()
	    api.searchParams.set('start_date', `gte.${adjustedFromStartBefore}`);
	  }
	  
	  if (to) {
	    // Normalize date string
	    const toDateStr = normalizeDateString(to);
	    
	    // Since events one day BEFORE the end date are the last ones showing,
	    // PostgREST is interpreting dates as one day earlier
	    // To fix: Add two days to the to date, then use lte (less than or equal)
	    // This way: lte.2025-12-09 will be interpreted as lte.2025-12-08, which includes Dec 7th
	    const [year, month, day] = toDateStr.split('-').map(Number);
	    const endDate = new Date(year, month - 1, day);
	    endDate.setDate(endDate.getDate() + 2); // Add 2 days: 1 for timezone shift + 1 for inclusion
	    const adjustedTo = `${endDate.getFullYear()}-${String(endDate.getMonth() + 1).padStart(2, '0')}-${String(endDate.getDate()).padStart(2, '0')}`;
	    
	    // For 'to' filter, we need to combine with existing 'or' filter if 'from' is also set
	    // Include events that:
	    // 1. Start on or before the to date, OR
	    // 2. End on or before the to date (events that span across the to date), OR
	    // 3. Are undated
	    // Note: PostgREST doesn't easily support combining AND/OR filters, so we'll filter client-side
	    // For now, we'll set a simple filter and rely on client-side filtering for the 'to' date
	    // For 'to' filter, if 'from' is also set, skip server-side filtering
	    // PostgREST has issues with complex 'or' filters when both dates are set
	    // We'll rely on client-side filtering for the 'to' date when both filters are present
	    const existingStartDate = api.searchParams.get('start_date');
	    if (existingStartDate) {
	      // If we already have a 'from' filter, skip 'to' filter server-side
	      // Client-side filtering will handle the 'to' date
	      // This avoids PostgREST 400 errors from malformed 'or' filters
	    } else {
	      // Only 'to' filter (no 'from'): use simple end_date filter
	      // Don't use complex 'or' filter - just filter by end_date
	      api.searchParams.set('end_date', `lte.${adjustedTo}`);
	    }
	  }
	  
	  console.debug('Events API URL:', api.toString());
	  console.debug('Date filter params:', { from, to, fromDateStr: from ? normalizeDateString(from) : null });

      const res = await fetch(api, { headers: { apikey: key, Authorization: 'Bearer ' + key, Accept: 'application/json' }});
      if (!res.ok) throw new Error('Fetch failed: ' + res.status);
      const events = await res.json();
      
      // Fetch keywords for all events
      if (events && events.length > 0) {
        const eventIds = events.map(e => e.id).filter(id => id);
        if (eventIds.length > 0) {
          // Fetch event_keywords relationships - Supabase uses 'in' filter format: in.(id1,id2,id3)
          const relApi = new URL(url + '/rest/v1/event_keywords');
          relApi.searchParams.set('select', 'event_id,keyword_id');
          // Use PostgREST 'in' syntax: event_id=in.(uuid1,uuid2,...)
          const inFilter = eventIds.join(',');
          relApi.searchParams.set('event_id', `in.(${inFilter})`);
          
          const relRes = await fetch(relApi, { headers: { apikey: key, Authorization: 'Bearer ' + key, Accept: 'application/json' }});
          if (relRes.ok) {
            const relations = await relRes.json();
            const keywordIds = [...new Set(relations.map(r => r.keyword_id))];
            
            if (keywordIds.length > 0) {
              // Fetch keyword names
              const kwApi = new URL(url + '/rest/v1/keywords');
              kwApi.searchParams.set('select', 'id,name');
              const kwInFilter = keywordIds.join(',');
              kwApi.searchParams.set('id', `in.(${kwInFilter})`);
              
              const kwRes = await fetch(kwApi, { headers: { apikey: key, Authorization: 'Bearer ' + key, Accept: 'application/json' }});
              if (kwRes.ok) {
                const keywords = await kwRes.json();
                const keywordMap = new Map(keywords.map(kw => [kw.id, kw.name.toLowerCase()]));
                
                // Attach keywords to events
                const keywordsByEventId = new Map();
                relations.forEach(rel => {
                  const kwName = keywordMap.get(rel.keyword_id);
                  if (kwName) {
                    if (!keywordsByEventId.has(rel.event_id)) {
                      keywordsByEventId.set(rel.event_id, []);
                    }
                    keywordsByEventId.get(rel.event_id).push(kwName);
                  }
                });
                
                events.forEach(ev => {
                  ev.keywords = keywordsByEventId.get(ev.id) || [];
                });
              }
            }
          }
        }
      }
      
      return events;
    }

  function fmtRange(s, e){
    if (!s && !e) return '';
    if (s && !e) return s;
    if (!s && e) return e;
    return s === e ? s : `${s} ‚Äì ${e}`;
  }

  function formatEventDate(dateString) {
    if (!dateString) return '';
    // Parse date in local timezone to avoid timezone shifts
    // Date strings like "2025-12-20" should be parsed as local dates, not UTC
    const date = parseLocalDate(dateString);
    if (!date) return '';
    
    // Get abbreviated day name
    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
    
    // Get abbreviated month name
    const monthName = date.toLocaleDateString('en-US', { month: 'short' });
    
    // Get day number and add ordinal suffix
    const day = date.getDate();
    const ordinalSuffix = (day) => {
      if (day > 3 && day < 21) return 'th';
      switch (day % 10) {
        case 1: return 'st';
        case 2: return 'nd';
        case 3: return 'rd';
        default: return 'th';
      }
    };
    
    return `${dayName}, ${monthName} ${day}${ordinalSuffix(day)}`;
  }

  function getMonthName(dateString) {
    if (!dateString) return 'TBA';
    // Parse date in local timezone to avoid timezone shifts
    const date = parseLocalDate(dateString);
    if (!date) return 'TBA';
    return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  }

  function formatTime(timeString) {
    if (!timeString) return '';
    // Time is stored as HH:MM or HH:MM:SS format
    const parts = timeString.split(':');
    if (parts.length < 2) return timeString;
    const hours = parseInt(parts[0], 10);
    const minutes = parts[1];
    if (isNaN(hours)) return timeString;
    
    // Format as 12-hour time with AM/PM
    if (hours === 0) {
      return `12:${minutes} AM`;
    } else if (hours < 12) {
      return `${hours}:${minutes} AM`;
    } else if (hours === 12) {
      return `12:${minutes} PM`;
    } else {
      return `${hours - 12}:${minutes} PM`;
    }
  }

  function calculateDuration(startTime, endTime) {
    if (!startTime || !endTime) return '';
    
    // Parse times (format: HH:MM or HH:MM:SS)
    const parseTime = (timeStr) => {
      const parts = timeStr.split(':');
      if (parts.length < 2) return null;
      const hours = parseInt(parts[0], 10);
      const minutes = parseInt(parts[1], 10);
      if (isNaN(hours) || isNaN(minutes)) return null;
      return hours * 60 + minutes; // Convert to minutes
    };
    
    const startMinutes = parseTime(startTime);
    const endMinutes = parseTime(endTime);
    
    if (startMinutes === null || endMinutes === null) return '';
    if (endMinutes < startMinutes) return ''; // Invalid time range
    
    const durationMinutes = endMinutes - startMinutes;
    const hours = Math.floor(durationMinutes / 60);
    const minutes = durationMinutes % 60;
    
    if (hours === 0) {
      return `${minutes} min`;
    } else if (minutes === 0) {
      return `${hours} hr`;
    } else {
      return `${hours} hr ${minutes} min`;
    }
  }

  function getAllKeywords(rows) {
    const keywordSet = new Set();
    rows.forEach(ev => {
      if (ev.keywords && ev.keywords.length > 0) {
        ev.keywords.forEach(kw => keywordSet.add(kw));
      }
    });
    return Array.from(keywordSet).sort();
  }

  // Calculate upcoming weekend dates (Friday, Saturday, and Sunday)
  function getUpcomingWeekend() {
    const today = new Date();
    const dayOfWeek = today.getDay(); // 0 = Sunday, 6 = Saturday
    
    let friday, sunday;
    
    if (dayOfWeek === 5) {
      // If today is Friday, use this weekend (today through Sunday)
      friday = new Date(today);
      sunday = new Date(today);
      sunday.setDate(today.getDate() + 2); // This Sunday
    } else if (dayOfWeek === 6) {
      // If today is Saturday, use this weekend (yesterday through tomorrow)
      friday = new Date(today);
      friday.setDate(today.getDate() - 1); // Yesterday (Friday)
      sunday = new Date(today);
      sunday.setDate(today.getDate() + 1); // Tomorrow (Sunday)
    } else if (dayOfWeek === 0) {
      // If today is Sunday, use this weekend (Friday through today)
      friday = new Date(today);
      friday.setDate(today.getDate() - 2); // Friday (2 days ago)
      sunday = new Date(today);
    } else {
      // Monday-Thursday: use this coming weekend
      const daysUntilFriday = 5 - dayOfWeek; // 1=Mon(4), 2=Tue(3), 3=Wed(2), 4=Thu(1)
      friday = new Date(today);
      friday.setDate(today.getDate() + daysUntilFriday);
      sunday = new Date(friday);
      sunday.setDate(friday.getDate() + 2); // Sunday (2 days after Friday)
    }
    
    // Format dates as YYYY-MM-DD using local time to avoid timezone issues
    function formatLocalDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    
    return {
      from: formatLocalDate(friday),
      to: formatLocalDate(sunday)
    };
  }

  // Calculate next weekend dates (Friday, Saturday, and Sunday)
  function getNextWeekend() {
    const today = new Date();
    const dayOfWeek = today.getDay(); // 0 = Sunday, 6 = Saturday
    
    let friday, sunday;
    
    if (dayOfWeek === 5) {
      // If today is Friday, next weekend is 7 days from today
      friday = new Date(today);
      friday.setDate(today.getDate() + 7); // Next Friday
      sunday = new Date(friday);
      sunday.setDate(friday.getDate() + 2); // Next Sunday
    } else if (dayOfWeek === 6) {
      // If today is Saturday, next weekend is 6 days from today
      friday = new Date(today);
      friday.setDate(today.getDate() + 6); // Next Friday
      sunday = new Date(friday);
      sunday.setDate(friday.getDate() + 2); // Next Sunday
    } else if (dayOfWeek === 0) {
      // If today is Sunday, next weekend is 5 days from today
      friday = new Date(today);
      friday.setDate(today.getDate() + 5); // Next Friday
      sunday = new Date(friday);
      sunday.setDate(friday.getDate() + 2); // Next Sunday
    } else {
      // Monday-Thursday: next weekend is the weekend after this coming one
      const daysUntilThisFriday = 5 - dayOfWeek; // Days until this Friday
      friday = new Date(today);
      friday.setDate(today.getDate() + daysUntilThisFriday + 7); // Next Friday (this Friday + 7 days)
      sunday = new Date(friday);
      sunday.setDate(friday.getDate() + 2); // Next Sunday
    }
    
    // Format dates as YYYY-MM-DD using local time to avoid timezone issues
    function formatLocalDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    
    return {
      from: formatLocalDate(friday),
      to: formatLocalDate(sunday)
    };
  }

  // Calculate current week dates (Monday to Sunday of the week containing today)
  function getUpcomingWeek() {
    const today = new Date();
    const dayOfWeek = today.getDay(); // 0 = Sunday, 6 = Saturday
    
    // Calculate days back to Monday of the current week
    // If today is Sunday (0), Monday is 6 days ago
    // If today is Monday (1), Monday is today (0 days ago)
    // If today is Tuesday-Saturday (2-6), Monday is (dayOfWeek - 1) days ago
    let daysBackToMonday;
    if (dayOfWeek === 0) {
      daysBackToMonday = 6; // Monday is 6 days ago (last Monday)
    } else {
      daysBackToMonday = dayOfWeek - 1; // Days back to Monday of current week
    }
    
    const monday = new Date(today);
    monday.setDate(today.getDate() - daysBackToMonday);
    
    const sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6); // Sunday is 6 days after Monday
    
    // Format dates as YYYY-MM-DD using local time to avoid timezone issues
    function formatLocalDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    
    return {
      from: formatLocalDate(monday),
      to: formatLocalDate(sunday)
    };
  }

  async function fetchAllKeywords({ url, key }) {
    try {
      const kwApi = new URL(url + '/rest/v1/keywords');
      kwApi.searchParams.set('select', 'id,name');
      kwApi.searchParams.set('order', 'name.asc');
      
      const kwRes = await fetch(kwApi, { 
        headers: { 
          apikey: key, 
          Authorization: 'Bearer ' + key, 
          Accept: 'application/json' 
        }
      });
      
      if (kwRes.ok) {
        const keywords = await kwRes.json();
        return keywords.map(kw => kw.name.toLowerCase()).sort();
      }
      return [];
    } catch (e) {
      console.error('Error fetching all keywords:', e);
      return [];
    }
  }

  function filterEventsByKeywords(events, selectedKeywords) {
    if (!selectedKeywords || selectedKeywords.length === 0) return events;
    // Normalize selected keywords to lowercase for consistent comparison
    const normalizedSelected = selectedKeywords.map(kw => (kw || '').toLowerCase().trim()).filter(kw => kw);
    return events.filter(ev => {
      if (!ev.keywords || ev.keywords.length === 0) return false;
      // Normalize event keywords to lowercase for consistent comparison
      const normalizedEventKeywords = ev.keywords.map(kw => (kw || '').toLowerCase().trim()).filter(kw => kw);
      // AND logic: event must have ALL selected keywords
      return normalizedSelected.every(selectedKw => normalizedEventKeywords.includes(selectedKw));
    });
  }

  function filterEventsBySignature(events, showSignatureEventsOnly) {
    // FIXED: The filter was inverted - when showSignatureEventsOnly is true, show ONLY signature events
    // When showSignatureEventsOnly is false, show ALL events
    if (!showSignatureEventsOnly) {
      // When toggle is OFF (showSignatureEventsOnly is false), show all events
      return events;
    }
    // When toggle is ON (showSignatureEventsOnly is true), filter to show only signature events
    return events.filter(ev => {
      // Check if event is a signature event (handle boolean, string, and number types)
      const isSignature = ev.is_signature_event === true || 
                         ev.is_signature_event === 'true' || 
                         ev.is_signature_event === 1 ||
                         (typeof ev.is_signature_event === 'string' && ev.is_signature_event.toLowerCase() === 'true');
      return isSignature;
    });
  }

  function filterEventsByDateRange(events, fromDate, toDate) {
    if (!fromDate && !toDate) return events;
    
    // Normalize date strings to YYYY-MM-DD format for consistent date-only comparison
    const normalizedFromDate = normalizeDateString(fromDate);
    const normalizedToDate = normalizeDateString(toDate);
    
    console.log('üîç filterEventsByDateRange called:', {
      fromDate,
      toDate,
      normalizedFromDate,
      normalizedToDate,
      totalEvents: events.length
    });
    
    return events.filter(ev => {
      const startDate = normalizeDateString(ev.start_date);
      const endDate = normalizeDateString(ev.end_date);
      
      // Undated events: include them if no filters are set, otherwise exclude
      if (!startDate && !endDate) {
        return !normalizedFromDate && !normalizedToDate;
      }
      
      // Proper date range overlap logic:
      // An event overlaps with [fromDate, toDate] if:
      // event.start_date <= toDate AND event.end_date >= fromDate
      
      // Handle single-day events (no end_date)
      if (startDate && !endDate) {
        const eventDate = startDate;
        // Event overlaps if it falls within the range
        if (normalizedFromDate && normalizedToDate) {
          return eventDate >= normalizedFromDate && eventDate <= normalizedToDate;
        } else if (normalizedFromDate) {
          return eventDate >= normalizedFromDate;
        } else if (normalizedToDate) {
          return eventDate <= normalizedToDate;
        }
        return true;
      }
      
      // Handle events with end_date but no start_date (shouldn't happen, but handle it)
      if (!startDate && endDate) {
        const eventDate = endDate;
        if (normalizedFromDate && normalizedToDate) {
          return eventDate >= normalizedFromDate && eventDate <= normalizedToDate;
        } else if (normalizedFromDate) {
          return eventDate >= normalizedFromDate;
        } else if (normalizedToDate) {
          return eventDate <= normalizedToDate;
        }
        return true;
      }
      
      // Handle events with both start_date and end_date
      if (startDate && endDate) {
        // Event overlaps with [fromDate, toDate] if:
        // event.start_date <= toDate AND event.end_date >= fromDate
        if (normalizedFromDate && normalizedToDate) {
          // Both filters set: check for overlap
          const check1 = startDate <= normalizedToDate;
          const check2 = endDate >= normalizedFromDate;
          const overlaps = check1 && check2;
          // Debug logging for troubleshooting
          if (!overlaps && ev.name && (ev.name.toLowerCase().includes('irish') || ev.name.toLowerCase().includes('dancing'))) {
            console.log('üîç Date overlap check (EXCLUDED):', {
              eventName: ev.name,
              startDate,
              endDate,
              normalizedFromDate,
              normalizedToDate,
              check1: `${startDate} <= ${normalizedToDate}`,
              check1Result: check1,
              check2: `${endDate} >= ${normalizedFromDate}`,
              check2Result: check2,
              overlaps
            });
          }
          if (overlaps && ev.name && (ev.name.toLowerCase().includes('irish') || ev.name.toLowerCase().includes('dancing'))) {
            console.log('‚úÖ Date overlap check (INCLUDED):', {
              eventName: ev.name,
              startDate,
              endDate,
              normalizedFromDate,
              normalizedToDate,
              overlaps
            });
          }
          return overlaps;
        } else if (normalizedFromDate) {
          // Only fromDate: event must end on or after fromDate
          return endDate >= normalizedFromDate;
        } else if (normalizedToDate) {
          // Only toDate: event must start on or before toDate
          return startDate <= normalizedToDate;
        }
        return true;
      }
      
      // Fallback: include if we can't determine
      return true;
    });
  }

  function groupEventsByMonth(events) {
    const grouped = {};
    events.forEach(event => {
      const month = getMonthName(event.start_date);
      if (!grouped[month]) {
        grouped[month] = [];
      }
      grouped[month].push(event);
    });
    return grouped;
  }

  // Parse date string in local timezone to avoid timezone shifts
  // Date strings like "2025-12-20" are parsed as local dates, not UTC
  function parseLocalDate(dateString) {
    if (!dateString) return null;
    const [year, month, day] = dateString.split('-').map(Number);
    return new Date(year, month - 1, day);
  }

  // Format date to YYYY-MM-DD string using local date components
  // This avoids timezone shifts when converting dates to strings
  function formatLocalDateString(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  function formatDayHeader(dateString) {
    if (!dateString) return 'TBA';
    // Parse date in local timezone to avoid timezone shifts
    const date = parseLocalDate(dateString);
    if (!date) return 'TBA';
    
    // Get full day name
    const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
    
    // Get full month name
    const monthName = date.toLocaleDateString('en-US', { month: 'long' });
    
    // Get day number and add ordinal suffix
    const day = date.getDate();
    const ordinalSuffix = (day) => {
      if (day > 3 && day < 21) return 'th';
      switch (day % 10) {
        case 1: return 'st';
        case 2: return 'nd';
        case 3: return 'rd';
        default: return 'th';
      }
    };
    
    return `${dayName}, ${monthName} ${day}${ordinalSuffix(day)}`;
  }

  function groupEventsByDay(events) {
    const grouped = {};
    
    events.forEach(event => {
      if (!event.start_date) {
        // Undated events go in a special group
        const key = 'TBA';
        if (!grouped[key]) {
          grouped[key] = [];
        }
        grouped[key].push(event);
        return;
      }
      
      // Parse dates in local timezone to avoid timezone shifts
      const startDate = parseLocalDate(event.start_date);
      const endDate = event.end_date ? parseLocalDate(event.end_date) : startDate;
      
      if (!startDate) return;
      
      // Iterate through each day the event is active
      const currentDate = new Date(startDate);
      while (currentDate <= endDate) {
        // Use local date components to create date key, avoiding timezone shifts
        const dateKey = formatLocalDateString(currentDate);
        
        if (!grouped[dateKey]) {
          grouped[dateKey] = [];
        }
        
        // Only add the event once per day (avoid duplicates if event already in this day)
        if (!grouped[dateKey].some(e => e.id === event.id)) {
          grouped[dateKey].push(event);
        }
        
        // Move to next day
        currentDate.setDate(currentDate.getDate() + 1);
      }
    });
    
    return grouped;
  }

  function renderListLayout(events, state) {
    const groupBy = state.groupBy || 'day';
    const { fromDate = null, toDate = null } = state;
    let grouped, groups, headerClass;
    
    if (groupBy === 'day') {
      grouped = groupEventsByDay(events);
      groups = Object.keys(grouped).sort((a, b) => {
        if (a === 'TBA') return 1;
        if (b === 'TBA') return -1;
        return a.localeCompare(b);
      });
      
      // Filter day groups to only include days within the date range
      if (fromDate || toDate) {
        // Normalize date strings for comparison
        const normalizedFromDate = normalizeDateString(fromDate);
        const normalizedToDate = normalizeDateString(toDate);
        
        groups = groups.filter(dayKey => {
          if (dayKey === 'TBA') {
            // Include TBA only if no fromDate is set (or if explicitly allowed)
            return !normalizedFromDate;
          }
          
          // Check if the day falls within the date range (dayKey is already YYYY-MM-DD format)
          if (normalizedFromDate && dayKey < normalizedFromDate) return false;
          if (normalizedToDate && dayKey > normalizedToDate) return false;
          return true;
        });
      }
      
      headerClass = 'ssa-day-header';
    } else {
      grouped = groupEventsByMonth(events);
      groups = Object.keys(grouped).sort((a, b) => {
        const dateA = new Date(grouped[a][0].start_date);
        const dateB = new Date(grouped[b][0].start_date);
        return dateA - dateB;
      });
      headerClass = 'ssa-month-header';
    }

    if (groups.length === 0) {
      return '<div class="ssa-empty">No events found.</div>';
    }

    let html = '';
    groups.forEach(groupKey => {
      const headerText = groupBy === 'day' ? formatDayHeader(groupKey) : groupKey;
      html += `<h3 class="${headerClass}">${headerText}</h3>`;
      html += `<ul class="ssa-events-list">`;
      
      grouped[groupKey].forEach((event, idx) => {
        const startDate = formatEventDate(event.start_date);
        const endDate = event.end_date ? formatEventDate(event.end_date) : '';
        const dateRange = endDate && startDate !== endDate ? `${startDate} - ${endDate}` : startDate;
        
        // Check if website_url exists and is not empty
        const hasWebsiteUrl = event.website_url && event.website_url.trim();
        let eventUrl = hasWebsiteUrl ? event.website_url.trim() : null;
        
        // Normalize URL: if it doesn't start with http:// or https://, prepend https://
        // This prevents relative URLs from being treated as relative to the current domain
        if (eventUrl && !eventUrl.match(/^https?:\/\//i)) {
          eventUrl = 'https://' + eventUrl;
        }
        
        // Escape URL for HTML attribute (escape quotes and ampersands)
        if (eventUrl) {
          eventUrl = eventUrl.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
          // Debug: Log URL for specific event
          if (event.name && event.name.includes('Sutter Creek Flea Market')) {
            console.debug('Sutter Creek Flea Market URL:', {
              original: event.website_url,
              trimmed: event.website_url ? event.website_url.trim() : null,
              normalized: eventUrl.replace(/&quot;/g, '"').replace(/&#39;/g, "'"),
              escaped: eventUrl,
              eventName: event.name
            });
          }
        }
        
        // Create unique event ID - use database ID if available, otherwise create hash
        const eventId = event.id ? `event-${event.id}` : `event-${btoa(event.name + (event.start_date || '')).replace(/[^a-zA-Z0-9]/g, '').substring(0, 10)}`;
        const hasImageUrl = event.image_url && event.image_url.trim();
        const showImage = hasImageUrl && state.showImages;
        
        html += `<li class="ssa-event-item" data-event-id="${eventId}" data-event-image="${hasImageUrl ? event.image_url : ''}">`;
        html += `<div class="ssa-event-content">`;
        
        // Event image on the left (only if showImages is enabled)
        if (showImage) {
          html += `<div class="ssa-event-image-wrapper" data-event-id="${eventId}" data-image-url="${event.image_url}">`;
          html += `<img src="${event.image_url}" alt="${event.name}" class="ssa-event-image" />`;
          html += `</div>`;
        }
        // No placeholder when showImages is off - this reduces page height
        
        // Event details on the right
        html += `<div class="ssa-event-details">`;
        html += `<span class="ssa-event-name-wrapper">`;
        
        // Info icon for description or URL
        const hasDescription = event.description && event.description.trim();
        html += `<span class="ssa-icon-group">`;
        if (hasDescription || hasWebsiteUrl) {
          const descriptionAttr = hasDescription ? `data-description="${event.description.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}"` : '';
          const urlAttr = hasWebsiteUrl ? `data-website-url="${eventUrl}"` : '';
          const titleText = hasDescription ? 'Hover to view description' : 'Click to open event website';
          html += `<span class="ssa-info-icon" data-event-id="${eventId}" ${descriptionAttr} ${urlAttr} title="${titleText}"></span>`;
        }
        
        // Image icon button - always show if image exists (regardless of showImages checkbox)
        if (hasImageUrl) {
          html += `<span class="ssa-image-icon-btn" data-event-id="${eventId}" data-image-url="${event.image_url}" title="Tap to view image">üñºÔ∏è</span>`;
        }
        
        // Location icon button (only if location exists)
        if (event.location) {
          html += `<span class="ssa-location-icon-btn" data-location="${event.location.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}" title="Tap to view map">üìç</span>`;
        }
        html += `</span>`;
        
        // Event name - only make it a link if website_url exists
        const nameClasses = hasWebsiteUrl ? 'ssa-event-link' : 'ssa-event-name';
        
        if (hasWebsiteUrl) {
          html += `<a href="${eventUrl}" class="${nameClasses}" target="_blank" rel="noopener">`;
          html += `<strong>${event.name}</strong>`;
          html += `</a>`;
        } else {
          html += `<strong class="${nameClasses}">${event.name}</strong>`;
        }
        html += `</span>`;
        
        // Event metadata - each on its own line for better mobile readability
        html += `<div class="ssa-event-meta">`;
        if (dateRange) {
          let dateTimeDisplay = dateRange;
          // Add start time if available
          if (event.start_time) {
            dateTimeDisplay += `, ${formatTime(event.start_time)}`;
            // Add end time if available
            if (event.end_time) {
              dateTimeDisplay += ` - ${formatTime(event.end_time)}`;
              // Add duration in parentheses
              const duration = calculateDuration(event.start_time, event.end_time);
              if (duration) {
                dateTimeDisplay += ` (${duration})`;
              }
            }
          }
          html += `<div class="ssa-event-meta-item"><strong>Date:</strong> ${dateTimeDisplay}</div>`;
        }
        if (event.location) {
          html += `<div class="ssa-event-meta-item"><strong>Location:</strong> <span class="ssa-location" data-location="${event.location.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}" title="Click to get directions">${event.location}</span></div>`;
        }
        if (event.host_org) {
          html += `<div class="ssa-event-meta-item"><strong>Host:</strong> ${event.host_org}</div>`;
        }
        html += `</div>`;
        html += `</div>`;
        
        // Keywords on their own line
        if (event.keywords && event.keywords.length > 0) {
          html += `<div class="ssa-event-keywords">`;
          html += event.keywords.map(kw => {
            const isSelected = state.selectedKeywords.includes(kw);
            return `<span class="ssa-keyword-tag-clickable ${isSelected ? 'ssa-keyword-tag-active' : ''}" data-keyword="${kw}">${kw}</span>`;
          }).join('');
          html += `</div>`;
        }
        
        html += `</div>`;
        html += `</li>`;
      });
      
      html += `</ul>`;
    });

    return html;
  }

  function renderGridLayout(events, state) {
    if (events.length === 0) {
      return '<div class="ssa-empty">No events found.</div>';
    }

    const selectedKeywords = state?.selectedKeywords || [];
    const showImages = state?.showImages || false;
    const cards = events.map(ev => {
      const hasImageUrl = ev.image_url && ev.image_url.trim();
      const showImage = hasImageUrl && showImages;
      const imageUrl = hasImageUrl ? ev.image_url.trim() : '';
      const imageStyle = showImage ? `style="--card-bg-image: url('${imageUrl.replace(/'/g, "\\'")}');"` : '';
      const eventId = ev.id ? `event-${ev.id}` : `event-${btoa(ev.name + (ev.start_date || '')).replace(/[^a-zA-Z0-9]/g, '').substring(0, 10)}`;
      const hasDescription = ev.description && ev.description.trim();
      const hasWebsiteUrl = ev.website_url && ev.website_url.trim();
      let eventUrl = hasWebsiteUrl ? ev.website_url.trim() : '';
      if (eventUrl && !eventUrl.match(/^https?:\/\//i)) {
        eventUrl = 'https://' + eventUrl;
      }
      if (eventUrl) {
        eventUrl = eventUrl.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
      }
      return `
      <article class="ssa-card" ${showImage ? `data-has-image="true"` : ''} ${imageStyle}>
        <div class="ssa-card-content">
        <header class="ssa-card-head">
          ${showImage ? `<div class="ssa-card-image-icon" data-event-id="${eventId}" data-image-url="${imageUrl}" title="Click to preview image"><img src="${imageUrl}" alt="${ev.name}" class="ssa-card-icon-thumb" /></div>` : ''}
          <h3 class="ssa-title">
            <span class="ssa-icon-group">
              ${hasDescription || hasWebsiteUrl ? (() => {
                const descriptionAttr = hasDescription ? `data-description="${ev.description.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}"` : '';
                const urlAttr = hasWebsiteUrl ? `data-website-url="${eventUrl}"` : '';
                const titleText = hasDescription ? 'Hover to view description' : 'Click to open event website';
                return `<span class="ssa-info-icon" data-event-id="${eventId}" ${descriptionAttr} ${urlAttr} title="${titleText}"></span>`;
              })() : ''}
              ${hasImageUrl ? `<span class="ssa-image-icon-btn" data-event-id="${eventId}" data-image-url="${imageUrl}" title="Tap to view image">üñºÔ∏è</span>` : ''}
                ${ev.location ? `<span class="ssa-location-icon-btn" data-location="${ev.location.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}" title="Tap to view map">üìç</span>` : ''}
              </span>
              ${ev.website_url ? (() => {
                let url = ev.website_url.trim();
                // Normalize URL: if it doesn't start with http:// or https://, prepend https://
                if (!url.match(/^https?:\/\//i)) {
                  url = 'https://' + url;
                }
                // Escape for HTML
                url = url.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                return `<a href="${url}" class="ssa-event-link" target="_blank" rel="noopener">${ev.name}</a>`;
              })() : `<span class="ssa-event-name">${ev.name}</span>`}
            </h3>
          </header>
          ${(() => {
            let dateTimeDisplay = fmtRange(ev.start_date, ev.end_date);
            // Add start time if available
            if (ev.start_time) {
              dateTimeDisplay += `, ${formatTime(ev.start_time)}`;
              // Add end time if available
              if (ev.end_time) {
                dateTimeDisplay += ` - ${formatTime(ev.end_time)}`;
                // Add duration in parentheses
                const duration = calculateDuration(ev.start_time, ev.end_time);
                if (duration) {
                  dateTimeDisplay += ` (${duration})`;
                }
              }
            }
            return `<p class="ssa-meta">${dateTimeDisplay}${ev.location ? ' ¬∑ <span class="ssa-location" data-location="' + ev.location.replace(/"/g, '&quot;').replace(/'/g, '&#39;') + '" title="Click to get directions">' + ev.location + '</span>' : ''}</p>`;
          })()}
          ${ev.recurrence ? `<p class="ssa-meta">${ev.recurrence}</p>` : ''}
          ${ev.keywords && ev.keywords.length > 0 ? `<p class="ssa-keywords">${ev.keywords.map(kw => {
            const isSelected = selectedKeywords.includes(kw);
            return `<span class="ssa-tag-clickable ${isSelected ? 'ssa-tag-active' : ''}" data-keyword="${kw}">${kw}</span>`;
          }).join('')}</p>` : ''}
        </div>
      </article>
    `;
    }).join('');

    return `<div class="ssa-grid">${cards}</div>`;
  }

  function renderCalendarLayout(events, state) {
    const { fromDate = null, toDate = null } = state;
    
    // Determine which month to display
    let displayDate;
    if (fromDate) {
      displayDate = parseLocalDate(fromDate) || new Date();
    } else if (toDate) {
      displayDate = parseLocalDate(toDate) || new Date();
    } else {
      displayDate = new Date();
    }
    
    // Get first day of month and number of days
    const year = displayDate.getFullYear();
    const month = displayDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = firstDay.getDay(); // 0 = Sunday, 6 = Saturday
    
    // Group events by day
    const eventsByDay = {};
    events.forEach(event => {
      if (!event.start_date) {
        // Skip undated events for calendar view
        return;
      }
      
      // Parse dates in local timezone to avoid timezone shifts
      const startDate = parseLocalDate(event.start_date);
      const endDate = event.end_date ? parseLocalDate(event.end_date) : startDate;
      
      if (!startDate) return;
      
      // Only include events that fall within the displayed month
      const monthStart = new Date(year, month, 1);
      const monthEnd = new Date(year, month + 1, 0);
      
      // Check if event overlaps with this month
      if (endDate < monthStart || startDate > monthEnd) {
        return;
      }
      
      // Iterate through each day the event is active within this month
      const currentDate = new Date(Math.max(startDate, monthStart));
      const maxDate = new Date(Math.min(endDate, monthEnd));
      
      while (currentDate <= maxDate) {
        const day = currentDate.getDate();
        // Use local date components to create date key, avoiding timezone shifts
        const dateKey = formatLocalDateString(currentDate);
        
        // Check if this day falls within the date range filter
        if (fromDate || toDate) {
          // Normalize date strings for comparison
          const normalizedFromDate = normalizeDateString(fromDate);
          const normalizedToDate = normalizeDateString(toDate);
          const dayDateStr = dateKey; // dateKey is already YYYY-MM-DD format
          
          if (normalizedFromDate && dayDateStr < normalizedFromDate) {
            currentDate.setDate(currentDate.getDate() + 1);
            continue;
          }
          if (normalizedToDate && dayDateStr > normalizedToDate) {
            currentDate.setDate(currentDate.getDate() + 1);
            continue;
          }
        }
        
        if (!eventsByDay[day]) {
          eventsByDay[day] = [];
        }
        
        // Only add the event once per day
        if (!eventsByDay[day].some(e => e.id === event.id)) {
          eventsByDay[day].push({
            ...event,
            _dateKey: dateKey
          });
        }
        
        // Move to next day
        currentDate.setDate(currentDate.getDate() + 1);
      }
    });
    
    // Build calendar HTML
    const monthName = displayDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    let html = `<div class="ssa-calendar-container">`;
    html += `<h3 class="ssa-calendar-month-header">${monthName}</h3>`;
    html += `<div class="ssa-calendar-grid">`;
    
    // Day headers
    const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    dayHeaders.forEach(day => {
      html += `<div class="ssa-calendar-day-header">${day}</div>`;
    });
    
    // Empty cells for days before month starts
    for (let i = 0; i < startingDayOfWeek; i++) {
      html += `<div class="ssa-calendar-day ssa-calendar-day-empty"></div>`;
    }
    
    // Days of the month
    for (let day = 1; day <= daysInMonth; day++) {
      const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      
      // Check if this day is outside the date filter range (only when both fromDate and toDate are set)
      let isOutOfRange = false;
      if (fromDate && toDate) {
        // Normalize date strings for comparison
        const normalizedFromDate = normalizeDateString(fromDate);
        const normalizedToDate = normalizeDateString(toDate);
        if (normalizedFromDate && normalizedToDate) {
          isOutOfRange = dateKey < normalizedFromDate || dateKey > normalizedToDate;
        }
      }
      
      // Filter dayEvents to only include events for days within the date range
      let dayEvents = eventsByDay[day] || [];
      if (fromDate || toDate) {
        // Normalize date strings for comparison
        const normalizedFromDate = normalizeDateString(fromDate);
        const normalizedToDate = normalizeDateString(toDate);
        
        dayEvents = dayEvents.filter(event => {
          const eventDateStr = event._dateKey || dateKey; // Already YYYY-MM-DD format
          if (normalizedFromDate && eventDateStr < normalizedFromDate) return false;
          if (normalizedToDate && eventDateStr > normalizedToDate) return false;
          return true;
        });
      }
      
      const outOfRangeClass = isOutOfRange ? ' ssa-calendar-day-out-of-range' : '';
      html += `<div class="ssa-calendar-day${outOfRangeClass}" data-date="${dateKey}">`;
      html += `<div class="ssa-calendar-day-number">${day}</div>`;
      
      if (dayEvents.length > 0) {
        html += `<div class="ssa-calendar-day-events">`;
        dayEvents.forEach(event => {
          const eventId = event.id ? `event-${event.id}` : `event-${btoa(event.name + (event.start_date || '')).replace(/[^a-zA-Z0-9]/g, '').substring(0, 10)}`;
          const description = event.description ? event.description.replace(/"/g, '&quot;').replace(/'/g, '&#39;') : '';
          const name = event.name ? event.name.replace(/"/g, '&quot;').replace(/'/g, '&#39;') : '';
          const startDate = event.start_date || '';
          const endDate = event.end_date || '';
          const location = event.location ? event.location.replace(/"/g, '&quot;').replace(/'/g, '&#39;') : '';
          const startTime = event.start_time || '';
          const endTime = event.end_time || '';
          let websiteUrl = event.website_url ? event.website_url.trim() : '';
          // Normalize URL: if it doesn't start with http:// or https://, prepend https://
          if (websiteUrl && !websiteUrl.match(/^https?:\/\//i)) {
            websiteUrl = 'https://' + websiteUrl;
          }
          websiteUrl = websiteUrl ? websiteUrl.replace(/"/g, '&quot;').replace(/'/g, '&#39;') : '';
          const keywords = event.keywords && event.keywords.length > 0 ? event.keywords.join(',') : '';

          // Always show info icon in calendar view (even without description)
          html += `<span class="ssa-calendar-info-icon ssa-info-icon" data-event-id="${eventId}" data-description="${description}" data-event-name="${name}" data-start-date="${startDate}" data-end-date="${endDate}" data-location="${location}" data-start-time="${startTime}" data-end-time="${endTime}" data-website-url="${websiteUrl}" data-keywords="${keywords}" data-calendar-view="true" title="Hover to view event details"></span>`;
        });
        html += `</div>`;
      }
      
      html += `</div>`;
    }
    
    // Empty cells for days after month ends
    const totalCells = startingDayOfWeek + daysInMonth;
    const remainingCells = 42 - totalCells; // 6 rows * 7 days = 42 cells
    for (let i = 0; i < remainingCells && totalCells + i < 42; i++) {
      html += `<div class="ssa-calendar-day ssa-calendar-day-empty"></div>`;
    }
    
    html += `</div></div>`;
    
    return html;
  }

  async function renderEvents(mount, rows, state) {
    const { layout = LAYOUTS.LIST, selectedKeywords = [], fromDate = null, toDate = null, groupBy = 'day', showImages = false, showSignatureEventsOnly = false } = state;
    
    // Store state on mount for handlers
    mount._currentState = state;
    
    // Use the rows parameter (most recent data) if it has events, otherwise fall back to mount._allRows
    // Always prefer the rows parameter since it's the most recent data passed to renderEvents
    // Update mount._allRows to keep it in sync for event handlers
    const allAvailableRows = rows && rows.length > 0 ? rows : (mount._allRows || []);
    
    // Keep mount._allRows in sync if rows is provided and different
    if (rows && rows.length > 0 && rows !== mount._allRows) {
      mount._allRows = rows;
    }
    
    // Apply all filters to get the final set of displayed events
    const dateFilteredRows = filterEventsByDateRange(allAvailableRows, fromDate, toDate);
    let filteredRows = filterEventsByKeywords(dateFilteredRows, selectedKeywords);
    filteredRows = filterEventsBySignature(filteredRows, showSignatureEventsOnly);
    
    // Get keywords only from events that match the date filters (not keyword filters)
    // This allows users to see what keywords are available to filter by for the selected date range
    // If we used filteredRows (after keyword filtering), users would only see keywords that co-occur
    // with already-selected keywords, which would be confusing
    const allKeywords = getAllKeywords(dateFilteredRows);
    
    // Debug logging to help diagnose keyword cloud updates
    console.log('üîç Keyword cloud update:', {
      rowsParamLength: rows.length,
      allAvailableRowsLength: allAvailableRows.length,
      dateFilteredRowsLength: dateFilteredRows.length,
      filteredRowsLength: filteredRows.length,
      allKeywordsCount: allKeywords.length,
      allKeywords: allKeywords,
      fromDate,
      toDate,
      hasMountAllRows: !!mount._allRows,
      mountAllRowsLength: mount._allRows ? mount._allRows.length : 0,
      sampleEventKeywords: dateFilteredRows.length > 0 && dateFilteredRows[0].keywords ? dateFilteredRows[0].keywords : 'no keywords',
      sampleEventName: dateFilteredRows.length > 0 ? dateFilteredRows[0].name : 'no events',
      eventsWithKeywords: dateFilteredRows.filter(ev => ev.keywords && ev.keywords.length > 0).length
    });
    
    // Render controls
    let controlsHTML = '<div class="ssa-controls">';

    // Date range filters (prominent section)
    controlsHTML += '<div class="ssa-date-filters-section">';
    controlsHTML += '<div class="ssa-date-filters">';
    controlsHTML += `<button class="ssa-weekend-btn ssa-this-week-btn" title="Set date range to current week (Monday to Sunday)">üìÜ This Week</button>`;
    controlsHTML += `<button class="ssa-weekend-btn ssa-this-weekend-btn" title="Set date range to upcoming weekend">üìÖ This Weekend</button>`;
    controlsHTML += `<button class="ssa-weekend-btn ssa-next-weekend-btn" title="Set date range to next weekend">üìÖ Next Weekend</button>`;
    controlsHTML += '<div class="ssa-date-inputs-row">';
    controlsHTML += `<label>From: <input type="date" class="ssa-date-input" id="ssa-from-date" value="${fromDate || ''}"></label>`;
    controlsHTML += `<label>To: <input type="date" class="ssa-date-input" id="ssa-to-date" value="${toDate || ''}"></label>`;
    controlsHTML += '</div>';
    controlsHTML += `<button class="ssa-clear-dates" title="Clear all filters">Clear</button>`;
    controlsHTML += '</div>';
    controlsHTML += '</div>';
    
    // Keyword filters - display all keywords from the system
    if (allKeywords.length > 0) {
      controlsHTML += '<div class="ssa-keyword-filters-section">';
      controlsHTML += '<div class="ssa-keyword-filters">';
      allKeywords.forEach(kw => {
        const isSelected = selectedKeywords.includes(kw);
        controlsHTML += `<button class="ssa-keyword-btn ${isSelected ? 'ssa-keyword-active' : ''}" data-keyword="${kw}">${kw}</button>`;
      });
      controlsHTML += '</div>';
      controlsHTML += '</div>';
    }
    
    // View controls section: View Types + Group By + Display Options (moved below keyword filters)
    controlsHTML += '<div class="ssa-view-controls-section">';
    
    // Left side: View Types and Group By
    controlsHTML += '<div class="ssa-view-controls-left">';
    controlsHTML += '<div class="ssa-layout-switcher-wrapper">';
    controlsHTML += '<label class="ssa-control-label">View:</label>';
    controlsHTML += '<div class="ssa-layout-switcher">';
    controlsHTML += `<button class="ssa-layout-btn ${layout === LAYOUTS.LIST ? 'ssa-active' : ''}" data-layout="${LAYOUTS.LIST}" title="List view">üìã</button>`;
    controlsHTML += `<button class="ssa-layout-btn ${layout === LAYOUTS.GRID ? 'ssa-active' : ''}" data-layout="${LAYOUTS.GRID}" title="Grid view">‚äû</button>`;
    controlsHTML += `<button class="ssa-layout-btn ${layout === LAYOUTS.CALENDAR ? 'ssa-active' : ''}" data-layout="${LAYOUTS.CALENDAR}" title="Calendar view">üìÖ</button>`;
    controlsHTML += '</div>';
    controlsHTML += '</div>';
    
    // Grouping switcher (only show for list layout)
    if (layout === LAYOUTS.LIST) {
      controlsHTML += '<div class="ssa-group-switcher-wrapper">';
      controlsHTML += '<label class="ssa-control-label">Group:</label>';
      controlsHTML += '<div class="ssa-group-switcher">';
      controlsHTML += `<button class="ssa-group-btn ${groupBy === 'day' ? 'ssa-active' : ''}" data-group="day" title="Group by day">üìÜ Day</button>`;
      controlsHTML += `<button class="ssa-group-btn ${groupBy === 'month' ? 'ssa-active' : ''}" data-group="month" title="Group by month">üìÖ Month</button>`;
      controlsHTML += '</div>';
      controlsHTML += '</div>';
    }
    controlsHTML += '</div>';
    
    // Right side: Display Options (Show Images, Signature Events, Dark Mode)
    const isDarkMode = document.body && document.body.classList.contains('dark-mode');
    controlsHTML += '<div class="ssa-display-options-wrapper">';
    controlsHTML += '<div class="ssa-display-options-switcher">';
    controlsHTML += `<button class="ssa-show-images-toggle ${showImages ? 'ssa-active' : ''}" id="ssa-show-images-btn" title="Toggle image display">üñºÔ∏è Show Images</button>`;
    controlsHTML += `<button class="ssa-signature-events-toggle ${showSignatureEventsOnly ? 'ssa-active' : ''}" id="ssa-signature-events-btn" title="Show only signature events">‚≠ê Signature Events Only</button>`;
    controlsHTML += '<button class="ssa-dark-mode-toggle" title="Toggle dark mode">' + (isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode') + '</button>';
    controlsHTML += '</div>';
    controlsHTML += '</div>';
    
    controlsHTML += '</div>';
    
    controlsHTML += '</div>';
    
    // Advertisement container at top (shows placeholder when empty for testing)
    let adHTML = '<div class="ssa-ad-container-top"><div class="ssa-ad-placeholder">Advertisement Space - Ready for content</div></div>';
    
    // Render events based on layout
    let eventsHTML = '';
    if (layout === LAYOUTS.LIST) {
      eventsHTML = renderListLayout(filteredRows, state);
    } else if (layout === LAYOUTS.GRID) {
      eventsHTML = renderGridLayout(filteredRows, state);
    } else if (layout === LAYOUTS.CALENDAR) {
      eventsHTML = renderCalendarLayout(filteredRows, state);
    }
    
    mount.innerHTML = adHTML + controlsHTML + eventsHTML;
    
    // Verify keyword cloud was rendered
    const keywordCloud = mount.querySelector('.ssa-keyword-filters');
    console.log('‚úÖ Keyword cloud rendered:', keywordCloud ? 'YES' : 'NO', keywordCloud ? `(${keywordCloud.querySelectorAll('.ssa-keyword-btn').length} buttons)` : '');
    
    // Initialize dark mode toggle (wrap in try-catch to prevent breaking event loading)
    try {
      initDarkModeToggle();
    } catch (e) {
      console.error('Error initializing dark mode toggle:', e);
    }
    
    // Attach event handlers
    // Use mount._allRows if available (contains all fetched events), otherwise use the rows parameter
    // This ensures event handlers have access to all events for filtering
    const allRowsForHandlers = mount._allRows || rows;
    attachEventHandlers(mount, allRowsForHandlers, state);
    
    // Inject styles if not already present
    injectStyles();
  }

  function attachEventHandlers(mount, rows, state) {
    // Layout switcher
    mount.querySelectorAll('.ssa-layout-btn').forEach(btn => {
      btn.addEventListener('click', async function() {
        const newLayout = this.dataset.layout;
        await renderEvents(mount, rows, { ...state, layout: newLayout });
      });
    });
    
    // Group switcher
    mount.querySelectorAll('.ssa-group-btn').forEach(btn => {
      btn.addEventListener('click', async function() {
        const newGroupBy = this.dataset.group;
        await renderEvents(mount, rows, { ...state, groupBy: newGroupBy });
      });
    });
    
    // Keyword filter buttons
    mount.querySelectorAll('.ssa-keyword-btn').forEach(btn => {
      btn.addEventListener('click', async function() {
        // Normalize keyword to lowercase for consistent storage and comparison
        const keyword = (this.dataset.keyword || '').toLowerCase().trim();
        if (!keyword) return;
        
        const isCurrentlySelected = state.selectedKeywords.includes(keyword);
        
        // Immediately toggle the active class for instant visual feedback
        if (isCurrentlySelected) {
          this.classList.remove('ssa-keyword-active');
        } else {
          this.classList.add('ssa-keyword-active');
        }
        
        const newSelected = isCurrentlySelected
          ? state.selectedKeywords.filter(k => k !== keyword)
          : [...state.selectedKeywords, keyword];
        await renderEvents(mount, rows, { ...state, selectedKeywords: newSelected });
      });
    });
    
    // Date inputs
    const fromInput = mount.querySelector('#ssa-from-date');
    const toInput = mount.querySelector('#ssa-to-date');
    const clearDatesBtn = mount.querySelector('.ssa-clear-dates');
    
    if (fromInput) {
      fromInput.addEventListener('change', async function() {
        const newFromDate = this.value || null;
        const newState = { ...state, fromDate: newFromDate };
        // Reload events if date filter changed
        if (mount._widgetOpts) {
          reloadEvents(mount, newState, mount._widgetOpts);
        } else {
          // Fallback: filter client-side if opts not available
          await renderEvents(mount, rows, newState);
        }
      });
    }
    
    if (toInput) {
      toInput.addEventListener('change', async function() {
        const newToDate = this.value || null;
        const newState = { ...state, toDate: newToDate };
        // Reload events if date filter changed
        if (mount._widgetOpts) {
          reloadEvents(mount, newState, mount._widgetOpts);
        } else {
          // Fallback: filter client-side if opts not available
          await renderEvents(mount, rows, newState);
        }
      });
    }
    
    if (clearDatesBtn) {
      clearDatesBtn.addEventListener('click', async function() {
        const newState = { ...state, fromDate: null, toDate: null, selectedKeywords: [], showSignatureEventsOnly: false };
        // Reload events to show all
        if (mount._widgetOpts) {
          reloadEvents(mount, newState, mount._widgetOpts);
        } else {
          // Fallback: filter client-side if opts not available
          await renderEvents(mount, rows, newState);
        }
      });
    }
    
    // Image display toggle checkbox
    const showImagesBtn = mount.querySelector('#ssa-show-images-btn');
    if (showImagesBtn) {
      showImagesBtn.addEventListener('click', async function() {
        const newShowImages = !state.showImages;
        const newState = { ...state, showImages: newShowImages };
        // Re-render events with updated image display setting (no need to reload from server)
        await renderEvents(mount, rows, newState);
      });
    }
    
    // Signature events toggle button
    const signatureEventsBtn = mount.querySelector('#ssa-signature-events-btn');
    if (signatureEventsBtn) {
      signatureEventsBtn.addEventListener('click', async function() {
        // Use mount._currentState to get the most up-to-date state
        const currentState = mount._currentState || state;
        const newShowSignatureEventsOnly = !currentState.showSignatureEventsOnly;
        const newState = { ...currentState, showSignatureEventsOnly: newShowSignatureEventsOnly };
        console.log('‚≠ê Signature Events toggle clicked:', { 
          oldValue: currentState.showSignatureEventsOnly, 
          newValue: newShowSignatureEventsOnly,
          newState 
        });
        // Re-render events with updated signature event filter (no need to reload from server)
        await renderEvents(mount, rows, newState);
      });
    }
    
    // Weekend button handlers
    const weekendBtn = mount.querySelector('.ssa-this-weekend-btn');
    if (weekendBtn) {
      weekendBtn.addEventListener('click', async function() {
        const weekend = getUpcomingWeekend();
        const newState = { ...state, fromDate: weekend.from, toDate: weekend.to };
        console.log('üìÖ This Weekend clicked:', { weekend, newState, hasWidgetOpts: !!mount._widgetOpts });
        // Update the input values
        if (fromInput) fromInput.value = weekend.from;
        if (toInput) toInput.value = weekend.to;
        // Reload events with weekend filter
        if (mount._widgetOpts) {
          console.log('üîÑ Calling reloadEvents');
          reloadEvents(mount, newState, mount._widgetOpts);
        } else {
          // Fallback: filter client-side if opts not available
          // Use mount._allRows to ensure we have all events for filtering
          console.log('‚ö†Ô∏è No widgetOpts, using client-side filtering');
          const allRows = mount._allRows || rows;
          console.log('üìä Using rows:', { allRowsLength: allRows.length, mountAllRowsLength: mount._allRows ? mount._allRows.length : 0 });
          await renderEvents(mount, allRows, newState);
        }
      });
    }
    
    // Next weekend button handler
    const nextWeekendBtn = mount.querySelector('.ssa-next-weekend-btn');
    if (nextWeekendBtn) {
      nextWeekendBtn.addEventListener('click', async function() {
        const weekend = getNextWeekend();
        console.log('üìÖ Next Weekend clicked:', { weekend, calculatedDates: weekend });
        const newState = { ...state, fromDate: weekend.from, toDate: weekend.to };
        console.log('üìÖ Next Weekend state:', { newState, fromDate: newState.fromDate, toDate: newState.toDate });
        // Update the input values
        if (fromInput) fromInput.value = weekend.from;
        if (toInput) toInput.value = weekend.to;
        // Reload events with next weekend filter
        if (mount._widgetOpts) {
          console.log('üîÑ Calling reloadEvents for Next Weekend');
          reloadEvents(mount, newState, mount._widgetOpts);
        } else {
          // Fallback: filter client-side if opts not available
          // Use mount._allRows to ensure we have all events for filtering
          console.log('‚ö†Ô∏è No widgetOpts, using client-side filtering for Next Weekend');
          const allRows = mount._allRows || rows;
          console.log('üìä Available rows for Next Weekend:', { allRowsLength: allRows.length });
          await renderEvents(mount, allRows, newState);
        }
      });
    }
    
    // This Week button handler
    const thisWeekBtn = mount.querySelector('.ssa-this-week-btn');
    if (thisWeekBtn) {
      thisWeekBtn.addEventListener('click', async function() {
        const week = getUpcomingWeek();
        const newState = { ...state, fromDate: week.from, toDate: week.to };
        console.log('üìÜ This Week clicked:', { week, newState, hasWidgetOpts: !!mount._widgetOpts });
        // Update the input values
        if (fromInput) fromInput.value = week.from;
        if (toInput) toInput.value = week.to;
        // Reload events with week filter
        if (mount._widgetOpts) {
          console.log('üîÑ Calling reloadEvents');
          reloadEvents(mount, newState, mount._widgetOpts);
        } else {
          // Fallback: filter client-side if opts not available
          // Use mount._allRows to ensure we have all events for filtering
          console.log('‚ö†Ô∏è No widgetOpts, using client-side filtering');
          const allRows = mount._allRows || rows;
          console.log('üìä Using rows:', { allRowsLength: allRows.length, mountAllRowsLength: mount._allRows ? mount._allRows.length : 0 });
          await renderEvents(mount, allRows, newState);
        }
      });
    }
    
    // Keyword tag clicks in list view
    if (state.layout === LAYOUTS.LIST) {
      mount.querySelectorAll('.ssa-keyword-tag-clickable').forEach(tag => {
        tag.addEventListener('click', async function() {
          // Normalize keyword to lowercase for consistent storage and comparison
          const keyword = (this.dataset.keyword || '').toLowerCase().trim();
          if (!keyword) return;
          
          // Toggle keyword in selected keywords
          const newSelected = state.selectedKeywords.includes(keyword)
            ? state.selectedKeywords.filter(k => k !== keyword)
            : [...state.selectedKeywords, keyword];
          
          await renderEvents(mount, rows, { ...state, selectedKeywords: newSelected });
        });
      });
    }
    
    // Keyword tag clicks in grid view
    if (state.layout === LAYOUTS.GRID) {
      mount.querySelectorAll('.ssa-tag-clickable').forEach(tag => {
        tag.addEventListener('click', async function() {
          // Normalize keyword to lowercase for consistent storage and comparison
          const keyword = (this.dataset.keyword || '').toLowerCase().trim();
          if (!keyword) return;
          
          // Toggle keyword in selected keywords
          const newSelected = state.selectedKeywords.includes(keyword)
            ? state.selectedKeywords.filter(k => k !== keyword)
            : [...state.selectedKeywords, keyword];
          
          await renderEvents(mount, rows, { ...state, selectedKeywords: newSelected });
        });
      });
    }
    
    // Shared image preview functionality
    let imagePreviewEl = null;
    
    function closeImagePreview() {
      if (imagePreviewEl) {
        imagePreviewEl.remove();
        imagePreviewEl = null;
      }
    }
    
    function showImagePreview(eventId, imageUrl, triggerElement) {
      if (!imageUrl || !imageUrl.trim()) return;
      
      // Close existing preview if clicking the same image
      if (imagePreviewEl && imagePreviewEl.dataset.eventId === eventId) {
        closeImagePreview();
        return;
      }
      
      // Close any existing preview
      closeImagePreview();
      
      const gap = 8;
      const viewportH = window.innerHeight;
      const viewportW = window.innerWidth;
      const maxH = Math.min(800, viewportH - gap * 2);
      const maxW = Math.min(800, viewportW - gap * 2);
      
      // Center the preview
      const previewW = maxW;
      const left = Math.max(gap, (viewportW - previewW) / 2);
      const top = Math.max(gap, (viewportH - maxH) / 2);
      
      // Create preview element with close button
      imagePreviewEl = document.createElement('div');
      imagePreviewEl.className = 'ssa-image-preview';
      imagePreviewEl.dataset.eventId = eventId;
      imagePreviewEl.style.cssText = `
        position: fixed;
        top: ${top}px;
        left: ${left}px;
        z-index: 10000;
        padding: 8px;
        background: rgba(255,255,255,0.98);
        border: 1px solid #d1d5db;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0,0,0,.25);
        width: ${previewW}px;
      `;
      
      // Close button
      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = '√ó';
      closeBtn.style.cssText = `
        position: absolute;
        top: 4px;
        right: 4px;
        width: 32px;
        height: 32px;
        border: none;
        background: rgba(0,0,0,0.6);
        color: white;
        border-radius: 50%;
        font-size: 24px;
        line-height: 1;
        cursor: pointer;
        z-index: 10001;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
      `;
      closeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        closeImagePreview();
      });
      closeBtn.addEventListener('mouseenter', function() {
        this.style.background = 'rgba(0,0,0,0.8)';
      });
      closeBtn.addEventListener('mouseleave', function() {
        this.style.background = 'rgba(0,0,0,0.6)';
      });
      
      const img = document.createElement('img');
      img.src = imageUrl;
      img.alt = 'Event preview';
      img.style.cssText = `
        width: auto;
        height: auto;
        max-width: ${previewW}px;
        max-height: ${maxH}px;
        border-radius: 6px;
        display: block;
      `;
      
      imagePreviewEl.appendChild(closeBtn);
      imagePreviewEl.appendChild(img);
      document.body.appendChild(imagePreviewEl);
      
      // Close on backdrop click (clicking on the preview container itself)
      imagePreviewEl.addEventListener('click', function(e) {
        if (e.target === imagePreviewEl) {
          closeImagePreview();
        }
      });
      
      // Close when clicking outside the preview
      // Use setTimeout to avoid immediate closure when opening
      setTimeout(function() {
        const outsideClickHandler = function(e) {
          if (imagePreviewEl && imagePreviewEl.dataset.eventId === eventId) {
            // Check if click is outside the preview
            const clickedInsidePreview = imagePreviewEl.contains(e.target);
            const clickedOnTrigger = triggerElement && triggerElement.contains(e.target);
            if (!clickedInsidePreview && !clickedOnTrigger) {
              closeImagePreview();
              document.removeEventListener('click', outsideClickHandler);
            }
          } else {
            // Preview was closed another way, remove listener
            document.removeEventListener('click', outsideClickHandler);
          }
        };
        document.addEventListener('click', outsideClickHandler);
      }, 100);
    }
    
    // Image click preview for grid view
    if (state.layout === LAYOUTS.GRID) {
      
      mount.querySelectorAll('.ssa-card-image-icon').forEach(icon => {
        const eventId = icon.dataset.eventId;
        const imageUrl = icon.dataset.imageUrl;
        if (!imageUrl || !imageUrl.trim()) return;
        
        icon.addEventListener('click', function(e) {
          e.stopPropagation();
          showImagePreview(eventId, imageUrl, icon);
        });
      });
      
      // Image icon button handlers for grid view
      mount.querySelectorAll('.ssa-image-icon-btn').forEach(btn => {
        const eventId = btn.dataset.eventId;
        const imageUrl = btn.dataset.imageUrl;
        if (!imageUrl || !imageUrl.trim()) return;
        
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          showImagePreview(eventId, imageUrl, btn);
        });
      });
    }
    
    // Close on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && imagePreviewEl) {
        closeImagePreview();
      }
    });
    
    // Image hover preview for list view (similar to info icon hover)
    let activeImagePopover = null;
    let imagePopoverTimeout = null;
    
    if (state.layout === LAYOUTS.LIST) {
      mount.querySelectorAll('.ssa-event-image-wrapper[data-image-url]').forEach(wrapper => {
        const eventId = wrapper.dataset.eventId;
        const imageUrl = wrapper.dataset.imageUrl;
        if (!imageUrl || !imageUrl.trim()) return;
        
        wrapper.addEventListener('mouseenter', function(e) {
          if (imagePopoverTimeout) clearTimeout(imagePopoverTimeout);
          
          // Remove any existing image popover
          if (activeImagePopover) {
            activeImagePopover.remove();
            activeImagePopover = null;
          }
          
          // Get element position
          const rect = wrapper.getBoundingClientRect();
          
          // Create image popover element
          const popover = document.createElement('div');
          popover.className = 'ssa-image-popover';
          popover.dataset.eventId = eventId;
          
          const gap = 8;
          const viewportH = window.innerHeight;
          const viewportW = window.innerWidth;
          const maxH = Math.min(800, viewportH - gap * 2);
          const maxW = Math.min(800, viewportW - gap * 2);
          
          // Create image element
          const img = document.createElement('img');
          img.src = imageUrl;
          img.alt = 'Event preview';
          img.style.cssText = `
            width: auto;
            height: auto;
            max-width: ${maxW}px;
            max-height: ${maxH}px;
            border-radius: 6px;
            display: block;
          `;
          
          popover.appendChild(img);
          document.body.appendChild(popover);
          
          // Get popover dimensions and viewport info
          const popoverRect = popover.getBoundingClientRect();
          const viewportHeight = window.innerHeight;
          const viewportWidth = window.innerWidth;
          const minGapFromEdge = 10;
          
          // Calculate horizontal position - prefer to the right, fall back to left, otherwise center
          let left = rect.right + gap;
          const spaceRight = viewportWidth - rect.right - gap;
          const spaceLeft = rect.left - gap;
          
          if (spaceRight >= popoverRect.width) {
            left = rect.right + gap;
          } else if (spaceLeft >= popoverRect.width) {
            left = rect.left - gap - popoverRect.width;
          } else {
            // Center horizontally within viewport
            left = Math.max(minGapFromEdge, Math.min(rect.left + rect.width / 2 - popoverRect.width / 2, viewportWidth - popoverRect.width - minGapFromEdge));
          }
          
          // Calculate vertical position - prefer to align with thumbnail, but keep within viewport
          let top = rect.top;
          if (rect.top < 120) {
            // near top ‚Äì align tops
            top = Math.max(minGapFromEdge, rect.top);
          } else if (rect.bottom > viewportHeight - 120) {
            // near bottom ‚Äì align bottoms
            top = Math.max(minGapFromEdge, rect.bottom - popoverRect.height);
          } else {
            // middle ‚Äì center vertically relative to thumbnail
            top = rect.top + rect.height / 2 - popoverRect.height / 2;
          }
          
          // Clamp inside viewport
          top = Math.max(minGapFromEdge, Math.min(top, viewportHeight - popoverRect.height - minGapFromEdge));
          
          popover.style.cssText = `
            position: fixed;
            left: ${left}px;
            top: ${top}px;
            z-index: 10002;
            padding: 6px;
            background: rgba(255,255,255,0.98);
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,.25);
            display: block;
          `;
          
          activeImagePopover = popover;
        });
        
        wrapper.addEventListener('mouseleave', function() {
          if (imagePopoverTimeout) clearTimeout(imagePopoverTimeout);
          imagePopoverTimeout = setTimeout(() => {
            if (activeImagePopover) {
              activeImagePopover.remove();
              activeImagePopover = null;
            }
          }, 100);
        });
        
        // Also handle mouseenter on popover itself to keep it open
        document.addEventListener('mouseenter', function(e) {
          const target = e.target.nodeType === Node.ELEMENT_NODE ? e.target : e.target.parentElement;
          if (target && target.closest && target.closest('.ssa-image-popover')) {
            if (imagePopoverTimeout) clearTimeout(imagePopoverTimeout);
          }
        }, true);
        
        // Handle mouseleave on popover
        document.addEventListener('mouseleave', function(e) {
          const target = e.target.nodeType === Node.ELEMENT_NODE ? e.target : e.target.parentElement;
          if (target && target.closest && target.closest('.ssa-image-popover')) {
            if (imagePopoverTimeout) clearTimeout(imagePopoverTimeout);
            imagePopoverTimeout = setTimeout(() => {
              if (activeImagePopover) {
                activeImagePopover.remove();
                activeImagePopover = null;
              }
            }, 100);
          }
        }, true);
      });
      
      // Image icon button handlers for list view (keep as click for mobile)
      mount.querySelectorAll('.ssa-image-icon-btn').forEach(btn => {
        const eventId = btn.dataset.eventId;
        const imageUrl = btn.dataset.imageUrl;
        if (!imageUrl || !imageUrl.trim()) return;
        
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          showImagePreview(eventId, imageUrl, btn);
        });
      });
    }
    
    // Description popover on hover for info icons (list and grid views)
    let activePopover = null;
    let popoverTimeout = null;
    
    mount.querySelectorAll('.ssa-info-icon').forEach(element => {
      const description = element.dataset.description;
      const websiteUrl = element.dataset.websiteUrl;
      const isCalendarView = element.dataset.calendarView === 'true';
      
      // Check if we have description or URL
      const hasDescription = description && description.trim();
      const hasUrl = websiteUrl && websiteUrl.trim();
      
      // For calendar view, always show popover even without description
      // For other views, if no description and no URL, skip (shouldn't happen, but safety check)
      if (!isCalendarView && !hasDescription && !hasUrl) return;
      
      // If no description but has URL, add click handler to open URL
      if (!hasDescription && hasUrl) {
        element.style.cursor = 'pointer';
        element.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          // Unescape the URL
          const unescapedUrl = websiteUrl.replace(/&quot;/g, '"').replace(/&#39;/g, "'");
          window.open(unescapedUrl, '_blank', 'noopener,noreferrer');
        });
        // Skip hover behavior for URL-only icons (unless it's calendar view which always shows popover)
        if (!isCalendarView) {
          return;
        }
      }
      
      // Decode HTML entities
      let decodedDescription = '';
      if (hasDescription) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = description;
        decodedDescription = tempDiv.textContent || tempDiv.innerText || description;
      }
      
      element.addEventListener('mouseenter', function(e) {
        if (popoverTimeout) clearTimeout(popoverTimeout);
        
        // Remove any existing popover
        if (activePopover) {
          activePopover.remove();
          activePopover = null;
        }
        
        // Get element position
        const rect = element.getBoundingClientRect();
        
        // Create popover element
        const popover = document.createElement('div');
        popover.className = 'ssa-info-popover';
        if (isCalendarView) {
          popover.classList.add('ssa-calendar-popover');
        }
        
        // Close button
        const closeBtn = document.createElement('button');
        closeBtn.innerHTML = '√ó';
        closeBtn.className = 'ssa-popover-close';
        closeBtn.style.cssText = `
          position: absolute;
          top: 4px;
          right: 4px;
          width: 24px;
          height: 24px;
          border: none;
          background: rgba(0,0,0,0.6);
          color: white;
          border-radius: 50%;
          font-size: 18px;
          line-height: 1;
          cursor: pointer;
          z-index: 10003;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background 0.2s;
          padding: 0;
        `;
        closeBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          if (activePopover) {
            activePopover.remove();
            activePopover = null;
          }
        });
        closeBtn.addEventListener('mouseenter', function() {
          this.style.background = 'rgba(0,0,0,0.8)';
        });
        closeBtn.addEventListener('mouseleave', function() {
          this.style.background = 'rgba(0,0,0,0.6)';
        });
        
        // Popover content - restructured for calendar view with fixed header/footer and scrollable middle
        const content = document.createElement('div');
        
        if (isCalendarView) {
          // Calendar view: show full event details with fixed layout
          const isDarkMode = document.body.classList.contains('dark-mode');
          const eventName = element.dataset.eventName || '';
          const startDate = element.dataset.startDate || '';
          const endDate = element.dataset.endDate || '';
          const location = element.dataset.location || '';
          const startTime = element.dataset.startTime || '';
          const endTime = element.dataset.endTime || '';
          const websiteUrl = element.dataset.websiteUrl || '';
          const keywordsStr = element.dataset.keywords || '';
          
          // Set up flexbox layout for popover
          content.style.cssText = 'display: flex; flex-direction: column; height: 100%; max-height: 400px; padding-right: 8px; overflow: hidden;';
          
          // Header section (fixed at top)
          const headerDiv = document.createElement('div');
          headerDiv.style.cssText = 'flex-shrink: 0; padding-bottom: 8px;';
          
          // Event name
          if (eventName) {
            const nameDiv = document.createElement('div');
            nameDiv.style.cssText = 'font-weight: 600; font-size: 1rem; margin-bottom: 8px;';
            
            if (websiteUrl && websiteUrl.trim()) {
              // Make it a clickable link
              let url = websiteUrl.trim();
              // Normalize URL: if it doesn't start with http:// or https://, prepend https://
              if (!url.match(/^https?:\/\//i)) {
                url = 'https://' + url;
              }
              const nameLink = document.createElement('a');
              nameLink.href = url;
              nameLink.target = '_blank';
              nameLink.rel = 'noopener noreferrer';
              nameLink.textContent = eventName;
              nameLink.style.cssText = 'color: #3b82f6; text-decoration: none; cursor: pointer;';
              nameLink.addEventListener('mouseenter', function() {
                this.style.textDecoration = 'underline';
              });
              nameLink.addEventListener('mouseleave', function() {
                this.style.textDecoration = 'none';
              });
              nameDiv.appendChild(nameLink);
            } else {
              // Plain text if no URL
              nameDiv.style.color = isDarkMode ? '#f9fafb' : '#1f2937';
              nameDiv.textContent = eventName;
            }
            
            headerDiv.appendChild(nameDiv);
          }
          
          // Date range
          if (startDate || endDate) {
            const dateDiv = document.createElement('div');
            dateDiv.style.cssText = `margin-bottom: 6px; font-size: 0.875rem; color: ${isDarkMode ? '#d1d5db' : '#000000'};`;
            let dateText = '';
            if (startDate) {
              dateText = formatEventDate(startDate);
              if (endDate && endDate !== startDate) {
                dateText += ' - ' + formatEventDate(endDate);
              }
            } else if (endDate) {
              dateText = formatEventDate(endDate);
            }
            
            // Add times if available
            if (startTime) {
              dateText += ', ' + formatTime(startTime);
              if (endTime) {
                dateText += ' - ' + formatTime(endTime);
              }
            }
            
            const dateLabel = document.createElement('strong');
            dateLabel.textContent = 'Date: ';
            dateLabel.style.cssText = `color: ${isDarkMode ? '#f9fafb' : '#000000'}; margin-right: 4px;`;
            dateDiv.appendChild(dateLabel);
            dateDiv.appendChild(document.createTextNode(dateText));
            headerDiv.appendChild(dateDiv);
          }
          
          // Location
          if (location) {
            const locationDiv = document.createElement('div');
            locationDiv.style.cssText = 'margin-bottom: 6px; font-size: 0.875rem;';
            const locationLabel = document.createElement('strong');
            locationLabel.textContent = 'Location: ';
            locationLabel.style.cssText = `color: ${isDarkMode ? '#f9fafb' : '#000000'}; margin-right: 4px;`;
            locationDiv.appendChild(locationLabel);
            
            // Make location a clickable link for directions
            const locationLink = document.createElement('span');
            locationLink.textContent = location;
            locationLink.style.cssText = 'color: #0f172a !important; text-decoration: none; cursor: pointer;';
            locationLink.addEventListener('mouseenter', function() {
              this.style.textDecoration = 'underline';
            });
            locationLink.addEventListener('mouseleave', function() {
              this.style.textDecoration = 'none';
            });
            locationLink.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              e.stopImmediatePropagation();
              const encodedLocation = encodeURIComponent(location);
              const mapUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedLocation}`;
              window.open(mapUrl, '_blank', 'noopener,noreferrer');
              return false;
            }, true);
            
            locationDiv.appendChild(locationLink);
            headerDiv.appendChild(locationDiv);
          }
          
          content.appendChild(headerDiv);
          
          // Scrollable middle section (description)
          if (decodedDescription) {
            const scrollableDiv = document.createElement('div');
            scrollableDiv.style.cssText = `flex: 1; overflow-y: auto; min-height: 0; margin-top: 8px; padding-top: 8px; border-top: 1px solid ${isDarkMode ? '#4b5563' : '#e5e7eb'}; font-size: 0.875rem; color: ${isDarkMode ? '#d1d5db' : '#4b5563'}; line-height: 1.5;`;
            scrollableDiv.textContent = decodedDescription;
            content.appendChild(scrollableDiv);
          } else {
            // Empty scrollable area if no description
            const scrollableDiv = document.createElement('div');
            scrollableDiv.style.cssText = 'flex: 1; min-height: 0;';
            content.appendChild(scrollableDiv);
          }
          
          // Footer section (fixed at bottom - keywords)
          if (keywordsStr) {
            const keywords = keywordsStr.split(',').filter(k => k.trim());
            if (keywords.length > 0) {
              const footerDiv = document.createElement('div');
              footerDiv.style.cssText = `flex-shrink: 0; margin-top: 12px; padding-top: 12px; border-top: 1px solid ${isDarkMode ? '#4b5563' : '#e5e7eb'}; display: flex; flex-wrap: wrap; gap: 6px;`;
              
              // Get current state from mount
              const mount = element.closest('#events-list') || document.querySelector('#events-list');
              const currentState = mount?._currentState || {};
              const selectedKeywords = currentState.selectedKeywords || [];
              
              keywords.forEach(keyword => {
                const keywordTag = document.createElement('span');
                const isSelected = selectedKeywords.includes(keyword);
                keywordTag.className = `ssa-keyword-tag-clickable ${isSelected ? 'ssa-keyword-tag-active' : ''}`;
                keywordTag.setAttribute('data-keyword', keyword);
                keywordTag.textContent = keyword;
                
                // Add hover styles (respect dark mode)
                const isDarkMode = document.body.classList.contains('dark-mode');
                keywordTag.addEventListener('mouseenter', function() {
                  if (!this.classList.contains('ssa-keyword-tag-active')) {
                    if (isDarkMode) {
                      this.style.background = '#4b5563';
                      this.style.borderColor = '#6b7280';
                    } else {
                      this.style.background = '#f9fafb';
                      this.style.borderColor = '#9ca3af';
                    }
                  }
                });
                keywordTag.addEventListener('mouseleave', function() {
                  if (!this.classList.contains('ssa-keyword-tag-active')) {
                    this.style.background = '';
                    this.style.borderColor = '';
                  }
                });
                
                // Click handler to toggle keyword filter
                keywordTag.addEventListener('click', async function(e) {
                  e.preventDefault();
                  e.stopPropagation();
                  
                  if (!mount || !mount._currentState) return;
                  
                  const state = mount._currentState;
                  const rows = mount._allRows || [];
                  // Normalize keyword to lowercase for consistent storage and comparison
                  const keyword = (this.dataset.keyword || '').toLowerCase().trim();
                  if (!keyword) return;
                  
                  // Toggle keyword in selected keywords
                  const newSelected = state.selectedKeywords.includes(keyword)
                    ? state.selectedKeywords.filter(k => k !== keyword)
                    : [...state.selectedKeywords, keyword];
                  
                  // Close popover
                  if (activePopover) {
                    activePopover.remove();
                    activePopover = null;
                  }
                  
                  // Update filters and re-render
                  await renderEvents(mount, rows, { ...state, selectedKeywords: newSelected });
                });
                
                footerDiv.appendChild(keywordTag);
              });
              
              content.appendChild(footerDiv);
            }
          }
        } else {
          // List/Grid view: show description only in scrollable container
          // Content already has the ssa-popover-content class which provides scrolling
          // But we need to ensure it has proper height constraints for scrolling to work
          // The popover has max-height: 400px with 12px padding, so content should be constrained
          // Use max-height instead of height so it only takes up needed space
          content.style.cssText = 'overflow-y: auto; overflow-x: hidden; max-height: 376px; word-wrap: break-word; white-space: normal; display: block;';
          content.textContent = decodedDescription;
        }
        
        popover.appendChild(closeBtn);
        popover.appendChild(content);
        document.body.appendChild(popover);
        
        // Get popover dimensions and viewport info
        const popoverRect = popover.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        const viewportWidth = window.innerWidth;
        const gap = 8;
        const minGapFromEdge = 10;
        
        // Calculate horizontal position (centered on element, but keep within viewport)
        let left = rect.left + (rect.width / 2) - (popoverRect.width / 2);
        if (left < minGapFromEdge) {
          left = minGapFromEdge;
        } else if (left + popoverRect.width > viewportWidth - minGapFromEdge) {
          left = viewportWidth - popoverRect.width - minGapFromEdge;
        }
        
        // Calculate vertical position - prefer above, but show below if not enough space
        let top = rect.top - popoverRect.height - gap;
        const spaceAbove = rect.top;
        const spaceBelow = viewportHeight - rect.bottom;
        
        // If not enough space above, position below instead
        if (top < minGapFromEdge || spaceAbove < popoverRect.height + gap + minGapFromEdge) {
          top = rect.bottom + gap;
          // If still doesn't fit below, position it at the top of viewport
          if (top + popoverRect.height > viewportHeight - minGapFromEdge) {
            top = minGapFromEdge;
          }
        }
        
        // Ensure popover doesn't go off bottom of viewport
        if (top + popoverRect.height > viewportHeight - minGapFromEdge) {
          top = viewportHeight - popoverRect.height - minGapFromEdge;
        }
        
        popover.style.position = 'fixed';
        popover.style.left = `${left}px`;
        popover.style.top = `${top}px`;
        popover.style.display = 'block';
        popover.style.zIndex = '10002';
        
        activePopover = popover;
        
        // Find all scrollable elements within the popover and attach listeners to them
        // This allows natural scrolling while preventing background scroll
        const scrollableElements = [];
        const findScrollableElements = function(element) {
          const style = window.getComputedStyle(element);
          const overflowY = style.overflowY;
          const overflow = style.overflow;
          const isScrollable = overflowY === 'auto' || overflowY === 'scroll' || 
                               overflow === 'auto' || overflow === 'scroll';
          const hasOverflow = element.scrollHeight > element.clientHeight;
          
          if (isScrollable && hasOverflow) {
            scrollableElements.push(element);
          }
          
          // Recursively check children
          for (let child of element.children) {
            findScrollableElements(child);
          }
        };
        
        findScrollableElements(popover);
        
        // Attach wheel event listeners to each scrollable element
        const scrollHandlers = [];
        scrollableElements.forEach(scrollableEl => {
          const handler = function(e) {
            const canScrollUp = scrollableEl.scrollTop > 0;
            const canScrollDown = scrollableEl.scrollTop < 
              (scrollableEl.scrollHeight - scrollableEl.clientHeight - 1);
            
            // If we can scroll, allow it and prevent background scroll
            if ((e.deltaY < 0 && canScrollUp) || (e.deltaY > 0 && canScrollDown)) {
              // Allow natural scroll, just prevent it from reaching document
              e.stopPropagation();
              return;
            }
            // At boundary, prevent background scroll
            e.preventDefault();
            e.stopPropagation();
          };
          scrollableEl.addEventListener('wheel', handler, { passive: false });
          scrollHandlers.push({ element: scrollableEl, handler: handler });
        });
        
        // Also prevent scrolling on the popover itself (non-scrollable areas)
        const popoverScrollHandler = function(e) {
          // If the event target is not a scrollable element, prevent background scroll
          let isOnScrollable = false;
          for (let scrollableEl of scrollableElements) {
            if (scrollableEl.contains(e.target)) {
              isOnScrollable = true;
              break;
            }
          }
          
          if (!isOnScrollable) {
            e.preventDefault();
            e.stopPropagation();
          }
        };
        popover.addEventListener('wheel', popoverScrollHandler, { passive: false });
        
        // Also prevent touchmove events on mobile
        const preventTouchScroll = function(e) {
          const target = e.target;
          const isInsidePopover = popover.contains(target);
          if (isInsidePopover) {
            // Allow scrolling within scrollable elements
            let scrollableElement = target;
            while (scrollableElement && scrollableElement !== document.body) {
              const style = window.getComputedStyle(scrollableElement);
              if (style.overflowY === 'auto' || style.overflowY === 'scroll' || 
                  style.overflow === 'auto' || style.overflow === 'scroll') {
                // Check if we can scroll
                const canScrollUp = scrollableElement.scrollTop > 0;
                const canScrollDown = scrollableElement.scrollTop < 
                  (scrollableElement.scrollHeight - scrollableElement.clientHeight - 1);
                
                // If we can scroll, allow it
                if (canScrollUp || canScrollDown) {
                  return; // Allow the scroll
                }
                // At boundary, prevent background scroll
                e.preventDefault();
                return;
              }
              if (scrollableElement === popover) {
                break;
              }
              scrollableElement = scrollableElement.parentElement;
            }
            // If not on a scrollable element, prevent default to stop background scroll
            e.preventDefault();
          }
        };
        
        document.addEventListener('touchmove', preventTouchScroll, { passive: false });
        
        // Clean up event listeners when popover is removed
        const originalRemove = popover.remove;
        popover.remove = function() {
          // Remove handlers from scrollable elements
          scrollHandlers.forEach(({ element, handler }) => {
            element.removeEventListener('wheel', handler);
          });
          popover.removeEventListener('wheel', popoverScrollHandler);
          document.removeEventListener('touchmove', preventTouchScroll);
          originalRemove.call(this);
        };
        
        // Close when clicking outside the popover
        // Use setTimeout to avoid immediate closure when opening via hover
        setTimeout(function() {
          const outsideClickHandler = function(e) {
            if (activePopover && activePopover === popover) {
              // Check if click is outside the popover
              const clickedInsidePopover = popover.contains(e.target);
              const clickedOnTrigger = element.contains(e.target);
              if (!clickedInsidePopover && !clickedOnTrigger) {
                if (activePopover) {
                  activePopover.remove();
                  activePopover = null;
                }
                document.removeEventListener('click', outsideClickHandler);
              }
            } else {
              // Popover was closed another way, remove listener
              document.removeEventListener('click', outsideClickHandler);
            }
          };
          document.addEventListener('click', outsideClickHandler);
        }, 100);
      });
      
      element.addEventListener('mouseleave', function() {
        if (popoverTimeout) clearTimeout(popoverTimeout);
        popoverTimeout = setTimeout(() => {
          if (activePopover) {
            activePopover.remove();
            activePopover = null;
          }
        }, 100);
      });
      
      // Also handle mouseenter on popover itself
      document.addEventListener('mouseenter', function(e) {
        const target = e.target.nodeType === Node.ELEMENT_NODE ? e.target : e.target.parentElement;
        if (target && target.closest && target.closest('.ssa-info-popover')) {
          if (popoverTimeout) clearTimeout(popoverTimeout);
        }
      }, true);
      
      // Handle mouseleave on popover
      document.addEventListener('mouseleave', function(e) {
        const target = e.target.nodeType === Node.ELEMENT_NODE ? e.target : e.target.parentElement;
        if (target && target.closest && target.closest('.ssa-info-popover')) {
          if (popoverTimeout) clearTimeout(popoverTimeout);
          popoverTimeout = setTimeout(() => {
            if (activePopover) {
              activePopover.remove();
              activePopover = null;
            }
          }, 100);
        }
      }, true);
    });
    
    // Close description popover on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && activePopover) {
        activePopover.remove();
        activePopover = null;
      }
    });
    
    // Shared map popover functionality
    if (!window._ssaMapPopoverState) {
      window._ssaMapPopoverState = {
        activePopover: null
      };
    }
    
    const mapPopoverState = window._ssaMapPopoverState;
    
    function closeMapPopover() {
      if (mapPopoverState.activePopover) {
        mapPopoverState.activePopover.remove();
        mapPopoverState.activePopover = null;
      }
    }
    
    function showMapPopover(location, triggerElement) {
      if (!location || !location.trim()) return;
      
      // Close existing popover if clicking the same location
      if (mapPopoverState.activePopover && mapPopoverState.activePopover.dataset.location === location) {
        closeMapPopover();
        return;
      }
      
      // Close any existing popover
      closeMapPopover();
      
      const encodedLocation = encodeURIComponent(location);
      const popoverWidth = 400;
      const popoverHeight = 300;
      const gap = 8;
      const viewportW = window.innerWidth;
      const viewportH = window.innerHeight;
      
      // Get trigger element position (or center if no element provided)
      let left, top;
      if (triggerElement) {
        const rect = triggerElement.getBoundingClientRect();
        left = rect.left + (rect.width / 2) - (popoverWidth / 2);
        if (left < 10) left = 10;
        if (left + popoverWidth > viewportW - 10) {
          left = viewportW - popoverWidth - 10;
        }
        
        top = rect.top - popoverHeight - gap;
        if (top < 10) {
          top = rect.bottom + gap;
        }
        if (top + popoverHeight > viewportH - 10) {
          top = viewportH - popoverHeight - 10;
        }
      } else {
        // Center if no trigger element
        left = Math.max(10, (viewportW - popoverWidth) / 2);
        top = Math.max(10, (viewportH - popoverHeight) / 2);
      }
      
      // Create map popover element
      const mapPopover = document.createElement('div');
      mapPopover.className = 'ssa-map-popover';
      mapPopover.dataset.location = location;
      
      // Close button
      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = '√ó';
      closeBtn.style.cssText = `
        position: absolute;
        top: 4px;
        right: 4px;
        width: 32px;
        height: 32px;
        border: none;
        background: rgba(0,0,0,0.6);
        color: white;
        border-radius: 50%;
        font-size: 24px;
        line-height: 1;
        cursor: pointer;
        z-index: 10004;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
      `;
      closeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        closeMapPopover();
      });
      closeBtn.addEventListener('mouseenter', function() {
        this.style.background = 'rgba(0,0,0,0.8)';
      });
      closeBtn.addEventListener('mouseleave', function() {
        this.style.background = 'rgba(0,0,0,0.6)';
      });
      
      // Create iframe with map
      const mapIframe = document.createElement('iframe');
      mapIframe.src = `https://www.google.com/maps?q=${encodedLocation}&output=embed`;
      mapIframe.style.width = '100%';
      mapIframe.style.height = '100%';
      mapIframe.style.border = '0';
      mapIframe.setAttribute('loading', 'lazy');
      mapIframe.setAttribute('allowfullscreen', '');
      mapIframe.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');
      mapIframe.setAttribute('frameborder', '0');
      mapIframe.style.pointerEvents = 'none'; // Disable iframe interactions so overlay works
      
      // Create clickable overlay for the map
      const mapOverlay = document.createElement('div');
      mapOverlay.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        cursor: pointer;
        z-index: 10003;
        background: transparent;
      `;
      mapOverlay.title = 'Click to open directions in Google Maps';
      
      mapPopover.style.cssText = `
        position: fixed;
        left: ${left}px;
        top: ${top}px;
        display: block;
        z-index: 10003;
        width: ${popoverWidth}px;
        height: ${popoverHeight}px;
        padding: 0;
        background: #fff;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        overflow: hidden;
      `;
      
      // Click handler for map overlay - open directions
      mapOverlay.addEventListener('click', function(e) {
        // Don't open directions if clicking the close button
        if (e.target === closeBtn || closeBtn.contains(e.target)) {
          return;
        }
        e.preventDefault();
        e.stopPropagation();
        const mapUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedLocation}`;
        const newWindow = window.open(mapUrl, '_blank', 'noopener,noreferrer');
        if (!newWindow) {
          window.location.href = mapUrl;
        }
      });
      
      mapPopover.appendChild(closeBtn);
      mapPopover.appendChild(mapIframe);
      mapPopover.appendChild(mapOverlay);
      document.body.appendChild(mapPopover);
      
      mapPopoverState.activePopover = mapPopover;
      
      // Close when clicking outside the popover
      // Use setTimeout to avoid immediate closure when opening
      setTimeout(function() {
        const outsideClickHandler = function(e) {
          if (mapPopoverState.activePopover && mapPopoverState.activePopover === mapPopover) {
            // Check if click is outside the popover
            const clickedInsidePopover = mapPopover.contains(e.target);
            const clickedOnTrigger = triggerElement && triggerElement.contains(e.target);
            if (!clickedInsidePopover && !clickedOnTrigger) {
              closeMapPopover();
              document.removeEventListener('click', outsideClickHandler);
            }
          } else {
            // Popover was closed another way, remove listener
            document.removeEventListener('click', outsideClickHandler);
          }
        };
        document.addEventListener('click', outsideClickHandler);
      }, 100);
    }
    
    // Location icon button handlers
    mount.querySelectorAll('.ssa-location-icon-btn').forEach(btn => {
      const location = btn.dataset.location;
      if (!location || !location.trim()) return;
      
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        showMapPopover(location, btn);
      });
    });
    
    // Location text click handlers - open directions
    const locationElements = mount.querySelectorAll('.ssa-location');
    locationElements.forEach(locationEl => {
      const location = locationEl.dataset.location;
      if (!location || !location.trim()) {
        return;
      }
      
      // Skip if already has handler
      if (locationEl.dataset.mapHandlerAttached === 'true') {
        return;
      }
      
      locationEl.dataset.mapHandlerAttached = 'true';
      locationEl.style.cursor = 'pointer';
      
      // Click handler to open directions in new tab
      locationEl.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        const encodedLocation = encodeURIComponent(location);
        // Use /dir/ endpoint for directions instead of /search/
        const mapUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedLocation}`;
        const newWindow = window.open(mapUrl, '_blank', 'noopener,noreferrer');
        if (!newWindow) {
          window.location.href = mapUrl;
        }
        return false;
      }, true);
      
      // Also handle clicks on parent elements
      const parent = locationEl.parentElement;
      if (parent && parent.tagName === 'STRONG') {
        parent.style.cursor = 'pointer';
        parent.addEventListener('click', function(e) {
          if (e.target === locationEl || locationEl.contains(e.target)) {
            e.preventDefault();
            e.stopPropagation();
            const encodedLocation = encodeURIComponent(location);
            const mapUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedLocation}`;
            const newWindow = window.open(mapUrl, '_blank', 'noopener,noreferrer');
            if (!newWindow) {
              window.location.href = mapUrl;
            }
            return false;
          }
        }, true);
      }
    });
    
    // Close map popover on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && mapPopoverState.activePopover) {
        closeMapPopover();
      }
    });
  }

  function injectStyles() {
    if (document.getElementById('ssa-styles-events')) return;
    
    const css = document.createElement('style');
    css.id = 'ssa-styles-events';
    css.textContent = `
      .ssa-controls{display:flex;flex-direction:column;gap:20px;margin-bottom:32px;padding:24px;background:#f9fafb;border-radius:12px;border:1px solid #e5e7eb}
      body.dark-mode .ssa-controls{background:#1f2937!important;border-color:#374151!important}
      .ssa-view-controls-section{display:flex;flex-wrap:wrap;gap:20px;align-items:center;justify-content:space-between;padding:16px;background:#fff;border-radius:8px;border:1px solid #e5e7eb}
      body.dark-mode .ssa-view-controls-section{background:#111827!important;border-color:#374151!important}
      .ssa-view-controls-left{display:flex;flex-wrap:wrap;gap:20px;align-items:center;flex:1}
      .ssa-layout-switcher-wrapper{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
      .ssa-group-switcher-wrapper{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
      .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{padding-left:20px;border-left:1px solid #e5e7eb}
      body.dark-mode .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{border-left-color:#374151!important}
      .ssa-display-options-wrapper{display:flex;align-items:center;justify-content:flex-end;flex-shrink:0}
      .ssa-display-options-switcher{display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-end}
      .ssa-control-label{font-size:0.875rem;font-weight:600;color:#374151;white-space:nowrap;text-transform:uppercase;letter-spacing:0.5px}
      body.dark-mode .ssa-control-label{color:#f9fafb!important}
      .ssa-layout-switcher{display:flex;gap:6px}
      .ssa-layout-btn{padding:10px 14px;border:1px solid #d1d5db;border-radius:8px;background:#fff;color:#374151;cursor:pointer;font-size:1.2rem;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
      .ssa-layout-btn:hover{background:#f9fafb;border-color:#9ca3af;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
      .ssa-layout-btn.ssa-active{background:#3b82f6;border-color:#3b82f6;color:#fff;box-shadow:0 2px 4px rgba(59,130,246,0.3)}
      body.dark-mode .ssa-layout-btn{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-layout-btn:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-layout-btn.ssa-active{background:transparent!important;border-color:#3b82f6!important;color:#3b82f6!important}
      body.dark-mode .ssa-layout-btn.ssa-active:hover{background:transparent!important;border-color:#60a5fa!important;color:#60a5fa!important}
      .ssa-group-switcher{display:flex;gap:6px}
      .ssa-group-btn{padding:8px 16px;border:1px solid #d1d5db;border-radius:8px;background:#fff!important;color:#374151!important;cursor:pointer;font-size:0.875rem;font-weight:500;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
      .ssa-group-btn:hover{background:#f9fafb!important;border-color:#9ca3af;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
      .ssa-group-btn.ssa-active{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important;box-shadow:0 2px 4px rgba(59,130,246,0.3)}
      body.dark-mode .ssa-group-btn{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-group-btn:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-group-btn.ssa-active{background:transparent!important;border-color:#3b82f6!important;color:#3b82f6!important}
      body.dark-mode .ssa-group-btn.ssa-active:hover{background:transparent!important;border-color:#60a5fa!important;color:#60a5fa!important}
      .ssa-date-filters-section{display:flex;flex-direction:column;gap:12px;padding:16px;background:#fff;border-radius:8px;border:1px solid #e5e7eb}
      body.dark-mode .ssa-date-filters-section{background:#111827!important;border-color:#374151!important}
      .ssa-date-filters{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center}
      .ssa-date-inputs-row{display:flex;gap:12px;align-items:center}
      .ssa-date-filters label{display:flex;align-items:center;gap:6px;font-size:0.875rem;color:#374151;font-weight:500}
      .ssa-date-input{padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.875rem;background:#fff;transition:all 0.2s}
      .ssa-date-input:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
      .ssa-clear-dates{padding:8px 16px;border:1px solid #d1d5db;border-radius:6px;background:#fff!important;color:#374151!important;cursor:pointer;font-size:0.875rem;font-weight:500;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
      .ssa-clear-dates:hover{background:#f9fafb!important;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
      .ssa-weekend-btn{padding:8px 16px;border:1px solid #d1d5db;border-radius:6px;background:#fff!important;color:#374151!important;cursor:pointer;font-size:0.875rem;font-weight:500;white-space:nowrap;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
      .ssa-weekend-btn:hover{background:#f9fafb!important;border-color:#9ca3af;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
      .ssa-show-images-toggle{padding:8px 16px;border:1px solid #d1d5db;border-radius:6px;background:#fff;color:#374151;cursor:pointer;font-size:0.875rem;font-weight:500;transition:all 0.2s;white-space:nowrap;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
      .ssa-show-images-toggle:hover{background:#f9fafb;border-color:#9ca3af;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
      .ssa-show-images-toggle.ssa-active{background:#3b82f6;border-color:#3b82f6;color:#fff;box-shadow:0 2px 4px rgba(59,130,246,0.3)}
      .ssa-show-images-toggle.ssa-active:hover{background:#2563eb;border-color:#2563eb}
      body.dark-mode .ssa-show-images-toggle{background:#374151;border-color:#4b5563;color:#f9fafb}
      body.dark-mode .ssa-show-images-toggle:hover{background:#4b5563;border-color:#6b7280}
      body.dark-mode .ssa-show-images-toggle.ssa-active{background:transparent!important;border-color:#3b82f6!important;color:#3b82f6!important}
      body.dark-mode .ssa-show-images-toggle.ssa-active:hover{background:transparent!important;border-color:#60a5fa!important;color:#60a5fa!important}
      .ssa-signature-events-toggle{padding:8px 16px;border:1px solid #d1d5db;border-radius:6px;background:#fff;color:#374151;cursor:pointer;font-size:0.875rem;font-weight:500;transition:all 0.2s;white-space:nowrap;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
      .ssa-signature-events-toggle:hover{background:#f9fafb;border-color:#9ca3af;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
      .ssa-signature-events-toggle.ssa-active{background:#3b82f6;border-color:#3b82f6;color:#fff;box-shadow:0 2px 4px rgba(59,130,246,0.3)}
      .ssa-signature-events-toggle.ssa-active:hover{background:#2563eb;border-color:#2563eb}
      body.dark-mode .ssa-signature-events-toggle{background:#374151;border-color:#4b5563;color:#f9fafb}
      body.dark-mode .ssa-signature-events-toggle:hover{background:#4b5563;border-color:#6b7280}
      body.dark-mode .ssa-signature-events-toggle.ssa-active{background:transparent!important;border-color:#3b82f6!important;color:#3b82f6!important}
      body.dark-mode .ssa-signature-events-toggle.ssa-active:hover{background:transparent!important;border-color:#60a5fa!important;color:#60a5fa!important}
      .ssa-dark-mode-toggle{padding:8px 16px;border:1px solid #d1d5db;border-radius:6px;background:#fff;color:#374151;cursor:pointer;font-size:0.875rem;font-weight:500;transition:all 0.2s;white-space:nowrap;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
      .ssa-dark-mode-toggle:hover{background:#f9fafb;border-color:#9ca3af;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
      body.dark-mode .ssa-dark-mode-toggle{background:#374151;border-color:#4b5563;color:#f9fafb}
      body.dark-mode .ssa-dark-mode-toggle:hover{background:#4b5563;border-color:#6b7280}
      .ssa-keyword-filters-section{display:flex;flex-direction:column;gap:12px;padding:16px;background:#fff;border-radius:8px;border:1px solid #e5e7eb}
      body.dark-mode .ssa-keyword-filters-section{background:#111827!important;border-color:#374151!important}
      .ssa-keyword-filters{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
      .ssa-keyword-btn{padding:8px 16px;border:2px solid #d1d5db;border-radius:20px;background:#fff!important;color:#374151!important;cursor:pointer;font-size:0.875rem;font-weight:500;transition:all 0.2s}
      .ssa-keyword-btn:hover{background:#f9fafb!important;border-color:#9ca3af!important;color:#374151!important}
      .ssa-keyword-active{background:#fff!important;border-color:#3b82f6!important;color:#3b82f6!important}
      .ssa-keyword-active:hover{background:#f0f9ff!important;border-color:#2563eb!important;color:#2563eb!important}
      body.dark-mode .ssa-keyword-filters{background:transparent!important}
      body.dark-mode .ssa-keyword-active{background:var(--ssa-control-bg, #374151)!important;border-color:#3b82f6!important;color:#3b82f6!important}
      body.dark-mode .ssa-keyword-active:hover{background:#4b5563!important;border-color:#60a5fa!important;color:#60a5fa!important}
      .ssa-empty{color:#6b7280;padding:20px;text-align:center}
      .ssa-skel{height:110px;border-radius:14px;background:linear-gradient(90deg,#f4f4f5,#f9fafb,#f4f4f5);background-size:200% 100%;animation:ssaShimmer 1.1s linear infinite}
      @keyframes ssaShimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
      .ssa-ad-container-top{width:100%;min-height:100px;margin-bottom:32px;padding:16px;background:#f9fafb;border:1px dashed #d1d5db;border-radius:8px;display:flex;align-items:center;justify-content:center}
      .ssa-ad-container-top:empty{display:none}
      .ssa-ad-placeholder{color:#9ca3af;font-size:0.875rem;text-align:center;font-style:italic}
      body.dark-mode .ssa-ad-placeholder{color:#6b7280!important}
      .ssa-ad-slot{width:100%;min-height:120px;margin:24px 0;padding:16px;background:#f9fafb;border:1px dashed #d1d5db;border-radius:8px;display:none}
      .ssa-ad-slot:not(:empty){display:block}
      body.dark-mode .ssa-ad-container-top{background:#1f2937!important;border-color:#4b5563!important}
      body.dark-mode .ssa-ad-slot{background:#1f2937!important;border-color:#4b5563!important}
      @media(max-width:768px){.ssa-ad-container-top{margin-bottom:24px;padding:12px;min-height:80px}}
      .ssa-month-header{margin:20px 0 10px;font-size:1.4rem;font-weight:700;color:#1f2937;letter-spacing:-0.02em}
      .ssa-day-header,.ssa-day-header *,#events-list .ssa-day-header,#events-list .ssa-day-header *{margin:20px 0 10px;font-size:1.4rem;font-weight:700;color:#000000!important;padding-bottom:10px;border-bottom:2px solid #e0e7ff;letter-spacing:-0.02em}
      @media(min-width:640px){
        .ssa-month-header{margin:22px 0 11px;font-size:1.6rem}
        .ssa-day-header,.ssa-day-header *,#events-list .ssa-day-header,#events-list .ssa-day-header *{margin:22px 0 11px;font-size:1.6rem;padding-bottom:11px}
      }
      @media(min-width:1024px){
        .ssa-month-header{margin:24px 0 12px;font-size:1.75rem}
        .ssa-day-header,.ssa-day-header *,#events-list .ssa-day-header,#events-list .ssa-day-header *{margin:24px 0 12px;font-size:1.75rem;padding-bottom:12px}
      }
      h3.ssa-day-header,h3.ssa-day-header *{color:#000000!important}
      .ssa-events-list{list-style:none;padding:0;margin:0 0 32px}
      .ssa-event-item{margin-bottom:16px;padding:12px;background:#fff;border:1px solid #e0e7ff;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.05);transition:all 0.3s ease}
      .ssa-event-item:hover{box-shadow:0 4px 12px rgba(0,0,0,0.1);background:#fafbff;transform:translateY(-1px)}
      .ssa-event-item:last-child{margin-bottom:0}
      .ssa-event-content{display:flex;gap:12px;align-items:flex-start}
      .ssa-event-image-wrapper{flex-shrink:0;width:60px;height:60px;border-radius:8px;overflow:hidden;background:#f3f4f6;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s ease;box-shadow:0 2px 4px rgba(0,0,0,0.08)}
      .ssa-event-image-wrapper:hover{box-shadow:0 4px 8px rgba(0,0,0,0.12);transform:scale(1.02)}
      .ssa-event-image-wrapper:active{opacity:0.7;transform:scale(0.98)}
      .ssa-event-image-wrapper.ssa-event-image-placeholder{background:#f9fafb;border:1px dashed #d1d5db;cursor:default}
      .ssa-event-image{width:100%;height:100%;object-fit:cover;display:block}
      .ssa-event-details{flex:1;min-width:0}
      .ssa-event-name-wrapper{display:inline-flex;align-items:center;gap:6px}
      .ssa-event-name-wrapper strong{font-size:1.1rem;font-weight:600;line-height:1.4;color:#1f2937}
      .ssa-event-link{font-size:1.1rem;font-weight:600;line-height:1.4;color:#3b82f6;text-decoration:none;cursor:pointer;transition:color 0.2s ease}
      .ssa-event-link:hover{color:#2563eb;text-decoration:underline}
      .ssa-event-name{cursor:default;color:#1f2937}
      .ssa-event-meta{margin-top:10px;display:flex;flex-direction:column;gap:4px}
      .ssa-event-meta-item,.ssa-event-meta-item *,#events-list .ssa-event-meta-item,#events-list .ssa-event-meta-item *{font-size:0.9rem;line-height:1.5;color:#374151!important}
      .ssa-event-meta-item strong,#events-list .ssa-event-meta-item strong,.ssa-event-meta-item strong *,#events-list .ssa-event-meta-item strong *{color:#1f2937!important;margin-right:6px;font-weight:600}
      div.ssa-event-meta-item,div.ssa-event-meta-item *{color:#374151!important}
      @media(min-width:640px){
        .ssa-event-item{margin-bottom:18px;padding:14px;border-radius:7px}
        .ssa-event-content{gap:16px}
        .ssa-event-image-wrapper{width:70px;height:70px;border-radius:9px}
        .ssa-event-name-wrapper strong{font-size:1.15rem}
        .ssa-event-link{font-size:1.15rem}
        .ssa-event-meta{margin-top:11px;gap:5px}
        .ssa-event-meta-item,.ssa-event-meta-item *,#events-list .ssa-event-meta-item,#events-list .ssa-event-meta-item *{font-size:0.925rem;line-height:1.55}
      }
      @media(min-width:1024px){
        .ssa-event-item{margin-bottom:20px;padding:16px;border-radius:8px}
        .ssa-event-content{gap:20px}
        .ssa-event-image-wrapper{width:80px;height:80px;border-radius:10px}
        .ssa-event-name-wrapper strong{font-size:1.25rem}
        .ssa-event-link{font-size:1.25rem}
        .ssa-event-meta{margin-top:12px;gap:6px}
        .ssa-event-meta-item,.ssa-event-meta-item *,#events-list .ssa-event-meta-item,#events-list .ssa-event-meta-item *{font-size:0.95rem;line-height:1.6}
      }
      .ssa-icon-group{display:inline-flex;align-items:center;gap:6px;flex-shrink:0}
      .ssa-info-icon{display:inline-flex!important;align-items:center;justify-content:center;font-size:0.7rem;opacity:0.8;cursor:help;transition:all 0.2s;flex-shrink:0;width:24px;height:24px;border-radius:50%;background:#3b82f6;color:#fff;font-weight:700;line-height:1;position:relative;vertical-align:middle;min-width:24px;min-height:24px}
      .ssa-info-icon::before{content:'i';font-style:normal;font-family:Georgia,serif;font-size:0.85rem}
      .ssa-info-icon:hover{opacity:1;background:#2563eb;transform:scale(1.1)}
      .ssa-image-icon-btn{display:none;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:#10b981;color:#fff;cursor:pointer;transition:all 0.2s;flex-shrink:0;font-size:0.9rem;opacity:0.8;min-width:24px;min-height:24px}
      .ssa-image-icon-btn:hover{opacity:1;background:#059669;transform:scale(1.1)}
      .ssa-image-icon-btn:active{opacity:0.7}
      .ssa-location-icon-btn{display:none;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:#f59e0b;color:#fff;cursor:pointer;transition:all 0.2s;flex-shrink:0;font-size:0.9rem;opacity:0.8;min-width:24px;min-height:24px}
      .ssa-location-icon-btn:hover{opacity:1;background:#d97706;transform:scale(1.1)}
      .ssa-location-icon-btn:active{opacity:0.7}
      .ssa-info-popover{padding:12px;background:#fff;border:1px solid #d1d5db;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);min-width:200px;max-width:300px;max-height:400px;font-size:0.875rem;line-height:1.5;color:#374151;white-space:normal;word-wrap:break-word;pointer-events:auto;position:relative}
      body.dark-mode .ssa-info-popover{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important;box-shadow:0 4px 12px rgba(0,0,0,0.3)!important}
      .ssa-calendar-popover{min-width:280px;max-width:400px}
      .ssa-popover-close{position:absolute;top:4px;right:4px;width:24px;height:24px;border:none;background:rgba(0,0,0,0.6);color:white;border-radius:50%;font-size:18px;line-height:1;cursor:pointer;z-index:10003;display:flex;align-items:center;justify-content:center;transition:background 0.2s;padding:0}
      .ssa-popover-close:hover{background:rgba(0,0,0,0.8)}
      .ssa-info-popover::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#fff}
      body.dark-mode .ssa-info-popover::after{border-top-color:#374151!important}
      .ssa-info-popover::before{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:7px solid transparent;border-top-color:#d1d5db;margin-top:-1px}
      body.dark-mode .ssa-info-popover::before{border-top-color:#4b5563!important}
      .ssa-link-icon{display:inline-flex;align-items:center;justify-content:center;font-size:0.875rem;opacity:0.7;transition:opacity 0.2s;margin-left:4px}
      .ssa-link-icon:hover{opacity:1}
      .ssa-location{cursor:pointer;text-decoration:underline;text-decoration-style:dotted;text-underline-offset:2px;color:#0f172a!important;transition:color 0.2s}
      .ssa-location:hover{color:#0f172a!important;text-decoration-style:solid}
      .ssa-card .ssa-location,.ssa-meta .ssa-location{color:#0f172a!important}
      .ssa-card .ssa-location:hover,.ssa-meta .ssa-location:hover{color:#0f172a!important}
      .ssa-map-popover{width:400px;height:300px;padding:0;background:#fff;border:1px solid #d1d5db;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);overflow:hidden;pointer-events:auto;position:fixed;z-index:10003}
      .ssa-map-popover::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#fff;z-index:1}
      .ssa-map-popover::before{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:7px solid transparent;border-top-color:#d1d5db;margin-top:-1px;z-index:0}
      .ssa-keywords-inline{display:inline-flex;flex-wrap:wrap;gap:4px;margin-left:8px}
      .ssa-tag{display:inline-block;padding:2px 8px;background:#f3f4f6;border-radius:12px;font-size:0.75rem;color:#6b7280}
      .ssa-event-keywords{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px}
      .ssa-keyword-tag-clickable{display:inline-block;padding:8px 16px;border:2px solid #d1d5db;border-radius:20px;background:#fff!important;color:#374151!important;cursor:pointer;font-size:0.875rem;font-weight:500;line-height:1.2;transition:all 0.2s}
      .ssa-keyword-tag-clickable:hover{background:#f9fafb!important;border-color:#9ca3af!important}
      .ssa-keyword-tag-clickable.ssa-keyword-tag-active{background:#fff!important;border-color:#3b82f6!important;color:#3b82f6!important}
      .ssa-keyword-tag-clickable.ssa-keyword-tag-active:hover{background:#f0f9ff!important;border-color:#2563eb!important;color:#2563eb!important}
      body.dark-mode .ssa-keyword-tag-clickable{background:var(--ssa-control-bg, #374151)!important;border-color:var(--ssa-control-border, #4b5563)!important;color:var(--ssa-text, #f9fafb)!important}
      body.dark-mode .ssa-keyword-tag-clickable:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-keyword-tag-clickable.ssa-keyword-tag-active{background:var(--ssa-control-bg, #374151)!important;border-color:#3b82f6!important;color:#3b82f6!important}
      body.dark-mode .ssa-keyword-tag-clickable.ssa-keyword-tag-active:hover{background:#4b5563!important;border-color:#60a5fa!important;color:#60a5fa!important}
      .ssa-grid{display:grid;gap:16px;grid-template-columns:1fr}
      @media(min-width:640px){.ssa-grid{grid-template-columns:repeat(2,1fr);gap:20px}}
      @media(min-width:1024px){.ssa-grid{grid-template-columns:repeat(3,1fr);gap:24px}}
      .ssa-calendar-container{margin:24px 0}
      .ssa-calendar-month-header{margin:0 0 20px;font-size:1.5rem;font-weight:700;color:#1f2937;text-align:center;letter-spacing:-0.02em}
      .ssa-calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:1px;background:#e0e7ff;border:1px solid #e0e7ff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
      .ssa-calendar-day-header{background:#f8f9fa;padding:8px 4px;text-align:center;font-size:0.75rem;font-weight:700;color:#4b5563;text-transform:uppercase;letter-spacing:0.05em}
      .ssa-calendar-day{background:#fff;min-height:70px;padding:4px;display:flex;flex-direction:column;position:relative;transition:background-color 0.2s ease}
      .ssa-calendar-day:hover{background:#fafbff}
      .ssa-calendar-day-empty{background:#f9fafb;opacity:0.5}
      .ssa-calendar-day-out-of-range{opacity:0.4;background:#f3f4f6}
      .ssa-calendar-day-out-of-range .ssa-calendar-day-number{color:#9ca3af}
      .ssa-calendar-day-number{font-size:0.85rem;font-weight:600;color:#1f2937;margin-bottom:4px}
      .ssa-calendar-day-events{display:flex;flex-wrap:wrap;gap:2px;align-items:flex-start}
      .ssa-calendar-info-icon{width:14px;height:14px;min-width:14px;min-height:14px;font-size:0.55rem;margin:0}
      .ssa-calendar-event-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:#3b82f6;opacity:0.7}
      @media(min-width:640px){
        .ssa-calendar-month-header{font-size:1.65rem;margin:0 0 24px}
        .ssa-calendar-grid{gap:2px;border-radius:10px}
        .ssa-calendar-day-header{padding:10px 4px;font-size:0.8rem}
        .ssa-calendar-day{min-height:80px;padding:6px}
        .ssa-calendar-day-number{font-size:0.9rem;margin-bottom:6px}
        .ssa-calendar-info-icon{width:16px;height:16px;min-width:16px;min-height:16px;font-size:0.6rem}
        .ssa-calendar-event-dot{width:8px;height:8px}
      }
      @media(min-width:1024px){
        .ssa-calendar-month-header{font-size:1.75rem;margin:0 0 20px}
        .ssa-calendar-grid{gap:2px;border-radius:12px}
        .ssa-calendar-day-header{padding:10px 4px;font-size:0.8rem}
        .ssa-calendar-day{min-height:85px;padding:6px}
        .ssa-calendar-day-number{font-size:0.9rem;margin-bottom:6px}
        .ssa-calendar-info-icon{width:16px;height:16px;min-width:16px;min-height:16px;font-size:0.6rem}
        .ssa-calendar-event-dot{width:8px;height:8px}
      }
      .ssa-card{border:1px solid #e0e7ff;border-radius:12px;padding:0;background:#fff;position:relative;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,0.05);transition:all 0.3s ease}
      .ssa-card:hover{box-shadow:0 6px 18px rgba(0,0,0,0.1);transform:translateY(-2px);border-color:#c7d2fe}
      .ssa-card[data-has-image="true"]{background-color:#fff}
      .ssa-card[data-has-image="true"]::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background-image:var(--card-bg-image);background-size:cover;background-position:center;background-repeat:no-repeat;opacity:0.2;z-index:0}
      .ssa-card[data-has-image="true"]::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(to bottom,rgba(255,255,255,0.6) 0%,rgba(255,255,255,0.4) 50%,rgba(255,255,255,0.3) 100%);z-index:1}
      .ssa-card[data-has-image="true"] .ssa-card-content{position:relative;z-index:2;padding:14px}
      .ssa-card:not([data-has-image="true"]) .ssa-card-content{padding:14px}
      .ssa-card-content{min-height:120px}
      .ssa-card-head{display:flex;align-items:center;gap:6px;position:relative}
      .ssa-card-image-icon{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:6px;overflow:hidden;cursor:pointer;opacity:0.8;transition:opacity 0.2s;flex-shrink:0;z-index:10;border:2px solid rgba(0,0,0,0.1)}
      .ssa-card-image-icon:hover{opacity:0.9;border-color:rgba(0,0,0,0.15)}
      .ssa-card-image-icon:active{opacity:0.7}
      .ssa-card-icon-thumb{width:100%;height:100%;object-fit:cover;display:block}
      .ssa-title{margin:0;font-size:1.05rem;line-height:1.35;color:#1f2937;font-weight:600;flex:1;display:inline-flex;align-items:center;gap:4px;letter-spacing:-0.01em}
      .ssa-meta{margin:.4rem 0;color:#000000!important;font-weight:500;font-size:0.9rem;line-height:1.5}
      .ssa-meta .ssa-location{color:#0f172a!important}
      @media(min-width:640px){
        .ssa-card{border-radius:14px;box-shadow:0 2px 7px rgba(0,0,0,0.055)}
        .ssa-card:hover{box-shadow:0 7px 21px rgba(0,0,0,0.11)}
        .ssa-card[data-has-image="true"] .ssa-card-content{padding:16px}
        .ssa-card:not([data-has-image="true"]) .ssa-card-content{padding:16px}
        .ssa-card-content{min-height:130px}
        .ssa-card-head{gap:7px}
        .ssa-card-image-icon{width:38px;height:38px}
        .ssa-title{font-size:1.1rem;gap:5px}
        .ssa-meta{font-size:0.925rem;line-height:1.55}
      }
      @media(min-width:1024px){
        .ssa-card{border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
        .ssa-card:hover{box-shadow:0 8px 24px rgba(0,0,0,0.12)}
        .ssa-card[data-has-image="true"] .ssa-card-content{padding:18px}
        .ssa-card:not([data-has-image="true"]) .ssa-card-content{padding:18px}
        .ssa-card-content{min-height:140px}
        .ssa-card-head{gap:8px}
        .ssa-card-image-icon{width:40px;height:40px}
        .ssa-title{font-size:1.15rem;gap:6px}
        .ssa-meta{font-size:0.95rem;line-height:1.6}
      }
      .ssa-keywords{margin:.5rem 0;display:flex;flex-wrap:wrap;gap:4px}
      .ssa-tag-clickable{display:inline-block;padding:8px 16px;border:2px solid #d1d5db;border-radius:20px;background:#fff!important;color:#374151!important;cursor:pointer;font-size:0.875rem;font-weight:500;line-height:1.2;transition:all 0.2s}
      .ssa-tag-clickable:hover{background:#f9fafb!important;border-color:#9ca3af!important}
      .ssa-tag-clickable.ssa-tag-active{background:#fff!important;border-color:#3b82f6!important;color:#3b82f6!important}
      .ssa-tag-clickable.ssa-tag-active:hover{background:#f0f9ff!important;border-color:#2563eb!important;color:#2563eb!important}
      body.dark-mode .ssa-tag-clickable{background:var(--ssa-control-bg, #374151)!important;border-color:var(--ssa-control-border, #4b5563)!important;color:var(--ssa-text, #f9fafb)!important}
      body.dark-mode .ssa-tag-clickable:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-tag-clickable.ssa-tag-active{background:var(--ssa-control-bg, #374151)!important;border-color:#3b82f6!important;color:#3b82f6!important}
      body.dark-mode .ssa-tag-clickable.ssa-tag-active:hover{background:#4b5563!important;border-color:#60a5fa!important;color:#60a5fa!important}
      .ssa-link{text-decoration:underline;color:#3b82f6;font-weight:500}
      @media(max-width:639px){
        #events-list{padding:0 12px;box-sizing:border-box;max-width:100%;overflow-x:hidden}
        *{box-sizing:border-box}
        .ssa-controls{padding:12px;gap:12px;margin:0 -12px 20px}
        .ssa-view-controls-section{padding:10px;flex-direction:row;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between}
        .ssa-view-controls-left{flex-direction:row;flex-wrap:wrap;gap:8px;flex:1;min-width:0}
        .ssa-layout-switcher-wrapper{flex-direction:row;align-items:center;gap:6px;flex:1;min-width:0}
        .ssa-group-switcher-wrapper{flex-direction:row;align-items:center;gap:6px;flex:1;min-width:0}
        .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{border-left:1px solid #e5e7eb;padding-left:8px;margin-left:0;border-top:none;padding-top:0;margin-top:0}
        body.dark-mode .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{border-left-color:#374151!important}
        .ssa-display-options-wrapper{flex-shrink:0;justify-content:flex-end}
        .ssa-display-options-switcher{flex-direction:row;flex-wrap:wrap;gap:6px;justify-content:flex-end}
        .ssa-date-filters-section{padding:10px}
        .ssa-date-filters{flex-direction:row;flex-wrap:wrap;align-items:center;gap:6px}
        .ssa-date-inputs-row{display:flex;flex-direction:row;gap:6px;width:100%;flex-basis:100%}
        .ssa-date-filters label{flex-direction:row;align-items:center;gap:4px;font-size:0.8rem;flex:1;min-width:0}
        .ssa-date-input{flex:1;padding:8px;font-size:0.85rem;min-height:40px;min-width:0}
        .ssa-clear-dates{width:100%;padding:8px;font-size:0.85rem;min-height:40px;flex-basis:100%}
        .ssa-weekend-btn{flex:1;min-width:calc(33.333% - 4px);padding:8px 4px;font-size:0.75rem;min-height:40px;white-space:normal;line-height:1.2;text-align:center}
        .ssa-keyword-filters-section{padding:10px}
        .ssa-control-label{font-size:0.75rem;margin-bottom:0;white-space:nowrap}
        .ssa-layout-switcher{display:flex;gap:6px;flex-wrap:wrap}
        .ssa-layout-btn{padding:8px 10px;font-size:1rem;min-height:40px}
        .ssa-group-switcher{gap:6px;flex:1;min-width:0}
        .ssa-group-btn{padding:8px 10px;font-size:0.85rem;min-height:40px;flex:1}
        .ssa-show-images-toggle,.ssa-signature-events-toggle,.ssa-dark-mode-toggle{flex:1;min-width:calc(33.333% - 4px);padding:8px 4px;font-size:0.75rem;min-height:40px;white-space:normal;line-height:1.2;text-align:center}
        .ssa-keyword-filters{gap:6px;justify-content:center}
        .ssa-keyword-btn{padding:8px 12px;font-size:0.8rem;min-height:36px;border-radius:18px}
        .ssa-event-item{padding:16px;margin-bottom:16px;max-width:100%;overflow-x:hidden}
        .ssa-event-content{flex-direction:column;gap:12px;max-width:100%}
        .ssa-event-image-wrapper{width:100%;height:200px;max-width:100%;box-sizing:border-box}
        .ssa-event-details{width:100%;max-width:100%;overflow-wrap:break-word;word-wrap:break-word}
        .ssa-event-name-wrapper{flex-wrap:wrap;gap:8px;margin-bottom:8px;max-width:100%}
        .ssa-event-name-wrapper strong{font-size:1.1rem;line-height:1.4;display:block;width:100%;overflow-wrap:break-word;word-wrap:break-word}
        .ssa-event-link{font-size:1.1rem;line-height:1.4;display:block;width:100%;margin-bottom:4px;overflow-wrap:break-word;word-wrap:break-word}
        .ssa-icon-group{gap:8px;margin-right:10px}
        .ssa-info-icon{width:44px;height:44px;min-width:44px;min-height:44px;flex-shrink:0;padding:0}
        .ssa-info-icon::before{font-size:1.2rem}
        .ssa-image-icon-btn{display:inline-flex!important;width:44px;height:44px;min-width:44px;min-height:44px;font-size:1.2rem}
        .ssa-location-icon-btn{display:inline-flex!important;width:44px;height:44px;min-width:44px;min-height:44px;font-size:1.2rem}
        .ssa-event-meta{margin-top:12px;gap:6px;max-width:100%}
        .ssa-event-meta-item{font-size:0.95rem;line-height:1.6;overflow-wrap:break-word;word-wrap:break-word}
        .ssa-event-meta-item strong{display:inline}
        .ssa-event-keywords{margin-top:12px;padding-top:12px;border-top:1px solid #e5e7eb;display:flex;flex-wrap:wrap;gap:6px;max-width:100%}
        .ssa-keyword-tag-clickable{padding:10px 14px;font-size:0.9rem;min-height:44px;border-radius:22px}
        .ssa-info-popover{max-width:calc(100vw - 20px);width:calc(100vw - 20px);left:10px!important;right:10px;font-size:1rem;line-height:1.6;max-height:60vh;padding:16px}
        .ssa-popover-close{width:32px;height:32px;font-size:24px;top:8px;right:8px}
        .ssa-card-content{padding:16px!important;min-height:auto;max-width:100%;overflow-wrap:break-word;word-wrap:break-word}
        .ssa-title{font-size:1rem;line-height:1.4;flex-wrap:wrap;gap:6px;max-width:100%;overflow-wrap:break-word;word-wrap:break-word}
        .ssa-title .ssa-info-icon{margin-bottom:4px}
        .ssa-meta{font-size:0.9rem;line-height:1.5;margin:8px 0}
        .ssa-keywords{margin:8px 0;gap:6px}
        .ssa-tag-clickable{padding:10px 14px;font-size:0.9rem;min-height:44px;border-radius:22px}
        .ssa-map-popover{width:calc(100vw - 20px)!important;height:250px;left:10px!important;right:10px}
      }
      @media(min-width:640px) and (max-width:1023px){
        #events-list{padding:0 16px;box-sizing:border-box;max-width:100%}
        .ssa-controls{padding:20px;gap:16px}
        .ssa-view-controls-section{padding:14px;flex-direction:row;flex-wrap:wrap;justify-content:space-between}
        .ssa-view-controls-left{flex-direction:row;flex-wrap:wrap;gap:16px;flex:1}
        .ssa-layout-switcher-wrapper{flex-direction:row;align-items:center;gap:10px}
        .ssa-group-switcher-wrapper{flex-direction:row;align-items:center;gap:10px}
        .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{padding-left:16px;border-left:1px solid #e5e7eb;border-top:none;padding-top:0;margin-top:0}
        body.dark-mode .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{border-left-color:#374151!important}
        .ssa-display-options-wrapper{flex-shrink:0;justify-content:flex-end}
        .ssa-display-options-switcher{flex-direction:row;flex-wrap:wrap;gap:10px;justify-content:flex-end}
        .ssa-date-filters-section{padding:14px}
        .ssa-date-filters{flex-direction:row;flex-wrap:wrap;align-items:center;gap:10px}
        .ssa-date-inputs-row{display:flex;flex-direction:row;gap:10px}
        .ssa-date-filters label{font-size:0.875rem;flex-direction:row}
        .ssa-date-input{padding:8px 10px;font-size:0.9rem;min-height:40px}
        .ssa-clear-dates{padding:8px 12px;font-size:0.875rem;min-height:40px}
        .ssa-weekend-btn{padding:8px 12px;font-size:0.875rem;min-height:40px}
        .ssa-keyword-filters-section{padding:14px}
        .ssa-control-label{font-size:0.875rem}
        .ssa-layout-btn{padding:9px 13px;font-size:1.15rem;min-height:42px}
        .ssa-group-btn{padding:9px 13px;font-size:0.875rem;min-height:42px}
        .ssa-show-images-toggle,.ssa-signature-events-toggle,.ssa-dark-mode-toggle{padding:8px 14px;font-size:0.875rem;min-height:40px}
        .ssa-keyword-btn{padding:9px 15px;font-size:0.875rem;min-height:40px}
        .ssa-keyword-tag-clickable,.ssa-tag-clickable{padding:9px 15px;font-size:0.875rem;line-height:1.2}
        .ssa-event-item{padding:14px;margin-bottom:18px}
        .ssa-event-content{flex-direction:row;gap:16px}
        .ssa-event-image-wrapper{width:70px;height:70px}
        .ssa-event-name-wrapper strong{font-size:1.15rem}
        .ssa-event-link{font-size:1.15rem}
        .ssa-event-meta{margin-top:11px;gap:5px}
        .ssa-event-meta-item{font-size:0.925rem}
        .ssa-card-content{padding:16px!important}
        .ssa-title{font-size:1.1rem}
        .ssa-meta{font-size:0.925rem}
        .ssa-map-popover{width:380px!important;height:280px!important}
      }
      @media(min-width:1024px){
        #events-list{padding:0 24px;box-sizing:border-box;max-width:1400px;margin:0 auto}
        .ssa-controls{padding:24px;gap:20px}
        .ssa-view-controls-section{padding:16px;justify-content:space-between}
        .ssa-view-controls-left{flex-direction:row;flex-wrap:wrap;gap:20px;flex:1}
        .ssa-layout-switcher-wrapper{flex-direction:row;align-items:center;gap:10px}
        .ssa-group-switcher-wrapper{flex-direction:row;align-items:center;gap:10px}
        .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{padding-left:20px;border-left:1px solid #e5e7eb;border-top:none;padding-top:0;margin-top:0}
        body.dark-mode .ssa-layout-switcher-wrapper ~ .ssa-group-switcher-wrapper{border-left-color:#374151!important}
        .ssa-display-options-wrapper{flex-shrink:0;justify-content:flex-end}
        .ssa-display-options-switcher{flex-direction:row;gap:10px;justify-content:flex-end}
        .ssa-date-filters-section{padding:16px}
        .ssa-date-filters{flex-direction:row;flex-wrap:wrap;align-items:center;gap:12px}
        .ssa-date-inputs-row{display:flex;flex-direction:row;gap:12px}
        .ssa-date-filters label{font-size:0.875rem;flex-direction:row}
        .ssa-date-input{padding:8px 12px;font-size:0.875rem;min-height:36px}
        .ssa-clear-dates{padding:8px 16px;font-size:0.875rem;min-height:36px}
        .ssa-weekend-btn{padding:8px 16px;font-size:0.875rem;min-height:36px}
        .ssa-keyword-filters-section{padding:16px}
        .ssa-control-label{font-size:0.875rem}
        .ssa-layout-btn{padding:10px 14px;font-size:1.2rem;min-height:40px}
        .ssa-group-btn{padding:8px 16px;font-size:0.875rem;min-height:40px}
        .ssa-show-images-toggle,.ssa-signature-events-toggle,.ssa-dark-mode-toggle{padding:8px 16px;font-size:0.875rem;min-height:36px}
        .ssa-keyword-btn{padding:8px 16px;font-size:0.875rem;min-height:36px}
        .ssa-keyword-tag-clickable,.ssa-tag-clickable{padding:8px 16px;font-size:0.875rem;line-height:1.2}
        .ssa-event-item{padding:16px;margin-bottom:20px}
        .ssa-event-content{flex-direction:row;gap:20px}
        .ssa-event-image-wrapper{width:80px;height:80px}
        .ssa-event-name-wrapper strong{font-size:1.25rem}
        .ssa-event-link{font-size:1.25rem}
        .ssa-event-meta{margin-top:12px;gap:6px}
        .ssa-event-meta-item{font-size:0.95rem}
        .ssa-card-content{padding:18px!important}
        .ssa-title{font-size:1.15rem}
        .ssa-meta{font-size:0.95rem}
        .ssa-map-popover{width:400px!important;height:300px!important}
      }
      .ssa-dark-mode-toggle{padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;background:#fff;color:#374151;cursor:pointer;font-size:0.875rem;font-weight:500;transition:all 0.2s;white-space:nowrap}
      .ssa-dark-mode-toggle:hover{background:#f9fafb;border-color:#9ca3af}
      body.dark-mode .ssa-dark-mode-toggle{background:#374151;border-color:#4b5563;color:#f9fafb}
      body.dark-mode .ssa-dark-mode-toggle:hover{background:#4b5563;border-color:#6b7280}
      body.dark-mode{background:#111827!important;color:#f9fafb!important}
      html body.dark-mode{background:#111827!important;color:#f9fafb!important}
      html.dark-mode,html body.dark-mode{background:#111827!important;color:#f9fafb!important}
      html.dark-mode body,html body.dark-mode{background:#111827!important;color:#f9fafb!important}
      body.dark-mode #events-list{background:#111827!important;color:#f9fafb!important}
      body.dark-mode #events-list *{color:inherit}
      body.dark-mode .Main-content{background:#111827!important}
      body.dark-mode .sqs-block{background:transparent!important}
      html.dark-mode .Main-content,html body.dark-mode .Main-content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Main,html body.dark-mode .Main{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Main-inner,html body.dark-mode .Main-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Content,html body.dark-mode .Content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Content-inner,html body.dark-mode .Content-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .page,html body.dark-mode .page{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .page-content,html body.dark-mode .page-content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-layout,html body.dark-mode .sqs-layout{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Site,html body.dark-mode .Site{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Site-inner,html body.dark-mode .Site-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #siteWrapper,html body.dark-mode #siteWrapper{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #site,html body.dark-mode #site{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #mainContent,html body.dark-mode #mainContent{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #content,html body.dark-mode #content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-wrapper,html body.dark-mode .sqs-wrapper{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-container,html body.dark-mode .sqs-container{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-row,html body.dark-mode .sqs-row{background:transparent!important}
      html.dark-mode .sqs-col,html body.dark-mode .sqs-col{background:transparent!important}
      html.dark-mode .sqs-block,html body.dark-mode .sqs-block{background:transparent!important}
      html.dark-mode .sqs-block-content,html body.dark-mode .sqs-block-content{background:transparent!important}
      html.dark-mode h1,html body.dark-mode h1,html.dark-mode h2,html body.dark-mode h2,html.dark-mode h3,html body.dark-mode h3,html.dark-mode h4,html body.dark-mode h4,html.dark-mode h5,html body.dark-mode h5,html.dark-mode h6,html body.dark-mode h6{color:#f9fafb!important}
      html.dark-mode p,html body.dark-mode p{color:#e5e7eb!important}
      html.dark-mode a,html body.dark-mode a{color:#60a5fa!important}
      html.dark-mode a:hover,html body.dark-mode a:hover{color:#93c5fd!important}
      body.dark-mode .Main{background:#111827!important}
      body.dark-mode .Main-inner{background:#111827!important}
      body.dark-mode .Content{background:#111827!important}
      body.dark-mode .Content-inner{background:#111827!important}
      body.dark-mode .page{background:#111827!important}
      body.dark-mode .page-content{background:#111827!important}
      body.dark-mode .sqs-layout{background:#111827!important}
      body.dark-mode .sqs-row{background:transparent!important}
      body.dark-mode .sqs-col{background:transparent!important}
      body.dark-mode .sqs-block-content{background:transparent!important}
      body.dark-mode .sqs-block-html{background:transparent!important}
      body.dark-mode .sqs-block-code{background:transparent!important}
      body.dark-mode .sqs-block-markdown{background:transparent!important}
      body.dark-mode .sqs-block-embed{background:transparent!important}
      body.dark-mode .sqs-block-image{background:transparent!important}
      body.dark-mode .sqs-block-video{background:transparent!important}
      body.dark-mode .sqs-block-summary-v2{background:transparent!important}
      body.dark-mode .sqs-block-form{background:transparent!important}
      body.dark-mode .sqs-block-button{background:transparent!important}
      body.dark-mode .sqs-block-spacer{background:transparent!important}
      body.dark-mode .sqs-block-divider{background:transparent!important}
      body.dark-mode .sqs-block-menu{background:transparent!important}
      body.dark-mode .sqs-block-socialaccountlinks{background:transparent!important}
      body.dark-mode .sqs-block-twitter{background:transparent!important}
      body.dark-mode .sqs-block-instagram{background:transparent!important}
      body.dark-mode .sqs-block-facebook{background:transparent!important}
      body.dark-mode .sqs-block-youtube{background:transparent!important}
      body.dark-mode .sqs-block-pinterest{background:transparent!important}
      body.dark-mode .sqs-block-tumblr{background:transparent!important}
      body.dark-mode .sqs-block-foursquare{background:transparent!important}
      body.dark-mode .sqs-block-vimeo{background:transparent!important}
      body.dark-mode .sqs-block-soundcloud{background:transparent!important}
      body.dark-mode .sqs-block-rss{background:transparent!important}
      body.dark-mode .sqs-block-linkedin{background:transparent!important}
      body.dark-mode .sqs-block-snapchat{background:transparent!important}
      body.dark-mode .sqs-block-medium{background:transparent!important}
      body.dark-mode .sqs-block-newsletter{background:transparent!important}
      body.dark-mode .sqs-block-calendar{background:transparent!important}
      body.dark-mode .sqs-block-gallery{background:transparent!important}
      body.dark-mode .sqs-block-map{background:transparent!important}
      body.dark-mode .sqs-block-audio{background:transparent!important}
      body.dark-mode .sqs-block-quote{background:transparent!important}
      body.dark-mode .sqs-block-animation{background:transparent!important}
      body.dark-mode .sqs-block-shape{background:transparent!important}
      body.dark-mode .sqs-block-chart{background:transparent!important}
      body.dark-mode .sqs-block-table{background:transparent!important}
      body.dark-mode .sqs-block-tagcloud{background:transparent!important}
      body.dark-mode .sqs-block-search{background:transparent!important}
      body.dark-mode .sqs-block-comments{background:transparent!important}
      body.dark-mode .sqs-block-blog{background:transparent!important}
      body.dark-mode .sqs-block-events{background:transparent!important}
      body.dark-mode .sqs-block-products{background:transparent!important}
      body.dark-mode .sqs-block-cart{background:transparent!important}
      body.dark-mode .sqs-block-newsletter{background:transparent!important}
      body.dark-mode .sqs-block-newsletter .newsletter-form{background:transparent!important}
      body.dark-mode .sqs-block-newsletter .newsletter-form-field-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-newsletter .newsletter-form-field-wrapper input{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-newsletter .newsletter-form-field-wrapper input::placeholder{color:#9ca3af!important}
      body.dark-mode .sqs-block-newsletter .newsletter-form-button{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .sqs-block-newsletter .newsletter-form-button:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .sqs-block-form .form-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list{background:transparent!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field{background:transparent!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field input{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field input::placeholder{color:#9ca3af!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field textarea{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field textarea::placeholder{color:#9ca3af!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field select{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field label{color:#f9fafb!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field .caption{color:#9ca3af!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field .field-error{color:#ef4444!important}
      body.dark-mode .sqs-block-form .form-wrapper .field-list .field .field-help{color:#9ca3af!important}
      body.dark-mode .sqs-block-form .form-wrapper .button{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .sqs-block-form .form-wrapper .button:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .sqs-block-button .sqs-block-button-element{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .sqs-block-button .sqs-block-button-element:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .sqs-block-button .sqs-block-button-element--primary{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .sqs-block-button .sqs-block-button-element--primary:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .sqs-block-button .sqs-block-button-element--secondary{background:transparent!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-button .sqs-block-button-element--secondary:hover{background:#374151!important;border-color:#6b7280!important}
      body.dark-mode .sqs-block-menu .menu{background:transparent!important}
      body.dark-mode .sqs-block-menu .menu .menu-item{background:transparent!important}
      body.dark-mode .sqs-block-menu .menu .menu-item a{color:#f9fafb!important}
      body.dark-mode .sqs-block-menu .menu .menu-item a:hover{color:#60a5fa!important}
      body.dark-mode .sqs-block-menu .menu .menu-item.active a{color:#60a5fa!important}
      body.dark-mode .sqs-block-menu .menu .menu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-menu .menu .menu-item .submenu{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-menu .menu .menu-item .submenu .menu-item{background:transparent!important}
      body.dark-mode .sqs-block-menu .menu .menu-item .submenu .menu-item a{color:#f9fafb!important}
      body.dark-mode .sqs-block-menu .menu .menu-item .submenu .menu-item a:hover{color:#60a5fa!important;background:#374151!important}
      body.dark-mode .sqs-block-menu .menu .menu-item .submenu .menu-item.active a{color:#60a5fa!important}
      body.dark-mode .sqs-block-menu .menu .menu-item .submenu .menu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-socialaccountlinks .sqs-svg-icon--wrapper{background:transparent!important}
      body.dark-mode .sqs-block-socialaccountlinks .sqs-svg-icon--wrapper svg{fill:#f9fafb!important}
      body.dark-mode .sqs-block-socialaccountlinks .sqs-svg-icon--wrapper:hover svg{fill:#60a5fa!important}
      body.dark-mode .sqs-block-image .image-block-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-image .image-block-wrapper img{opacity:0.95}
      body.dark-mode .sqs-block-image .image-block-wrapper:hover img{opacity:1}
      body.dark-mode .sqs-block-video .video-block-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-video .video-block-wrapper video{opacity:0.95}
      body.dark-mode .sqs-block-video .video-block-wrapper:hover video{opacity:1}
      body.dark-mode .sqs-block-gallery .gallery-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-gallery .gallery-wrapper .gallery-item{background:transparent!important}
      body.dark-mode .sqs-block-gallery .gallery-wrapper .gallery-item img{opacity:0.95}
      body.dark-mode .sqs-block-gallery .gallery-wrapper .gallery-item:hover img{opacity:1}
      body.dark-mode .sqs-block-quote .quote-block{background:transparent!important}
      body.dark-mode .sqs-block-quote .quote-block .quote-content{color:#f9fafb!important}
      body.dark-mode .sqs-block-quote .quote-block .quote-author{color:#9ca3af!important}
      body.dark-mode .sqs-block-quote .quote-block .quote-author::before{color:#4b5563!important}
      body.dark-mode .sqs-block-quote .quote-block .quote-author::after{color:#4b5563!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item .summary-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item .summary-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item .summary-metadata{color:#9ca3af!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item .summary-metadata a{color:#60a5fa!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item .summary-metadata a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-summary-v2 .summary-item .summary-thumbnail img{opacity:0.95}
      body.dark-mode .sqs-block-summary-v2 .summary-item:hover .summary-thumbnail img{opacity:1}
      body.dark-mode .sqs-block-blog .blog-item{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-blog .blog-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-blog .blog-item .blog-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-blog .blog-item .blog-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-blog .blog-item .blog-metadata{color:#9ca3af!important}
      body.dark-mode .sqs-block-blog .blog-item .blog-metadata a{color:#60a5fa!important}
      body.dark-mode .sqs-block-blog .blog-item .blog-metadata a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-blog .blog-item .blog-thumbnail img{opacity:0.95}
      body.dark-mode .sqs-block-blog .blog-item:hover .blog-thumbnail img{opacity:1}
      body.dark-mode .sqs-block-events .event-item{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-events .event-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-events .event-item .event-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-events .event-item .event-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-events .event-item .event-metadata{color:#9ca3af!important}
      body.dark-mode .sqs-block-events .event-item .event-metadata a{color:#60a5fa!important}
      body.dark-mode .sqs-block-events .event-item .event-metadata a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-events .event-item .event-thumbnail img{opacity:0.95}
      body.dark-mode .sqs-block-events .event-item:hover .event-thumbnail img{opacity:1}
      body.dark-mode .sqs-block-products .product-item{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-products .product-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-products .product-item .product-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-products .product-item .product-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-products .product-item .product-price{color:#f9fafb!important}
      body.dark-mode .sqs-block-products .product-item .product-price .product-price-on-sale{color:#ef4444!important}
      body.dark-mode .sqs-block-products .product-item .product-price .product-price-original{color:#9ca3af!important;text-decoration:line-through}
      body.dark-mode .sqs-block-products .product-item .product-metadata{color:#9ca3af!important}
      body.dark-mode .sqs-block-products .product-item .product-metadata a{color:#60a5fa!important}
      body.dark-mode .sqs-block-products .product-item .product-metadata a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-products .product-item .product-thumbnail img{opacity:0.95}
      body.dark-mode .sqs-block-products .product-item:hover .product-thumbnail img{opacity:1}
      body.dark-mode .sqs-block-cart .cart-item{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-cart .cart-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-cart .cart-item .cart-item-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-cart .cart-item .cart-item-price{color:#f9fafb!important}
      body.dark-mode .sqs-block-cart .cart-item .cart-item-quantity{color:#f9fafb!important}
      body.dark-mode .sqs-block-cart .cart-item .cart-item-total{color:#f9fafb!important}
      body.dark-mode .sqs-block-cart .cart-item .cart-item-remove{color:#ef4444!important}
      body.dark-mode .sqs-block-cart .cart-item .cart-item-remove:hover{color:#dc2626!important}
      body.dark-mode .sqs-block-cart .cart-total{color:#f9fafb!important}
      body.dark-mode .sqs-block-cart .cart-total .cart-total-label{color:#9ca3af!important}
      body.dark-mode .sqs-block-cart .cart-total .cart-total-amount{color:#f9fafb!important}
      body.dark-mode .sqs-block-cart .cart-checkout-button{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .sqs-block-cart .cart-checkout-button:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .sqs-block-search .search-input{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-search .search-input::placeholder{color:#9ca3af!important}
      body.dark-mode .sqs-block-search .search-button{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .sqs-block-search .search-button:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .sqs-block-search .search-results{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-search .search-results .search-result-item{background:transparent!important;border-color:#374151!important}
      body.dark-mode .sqs-block-search .search-results .search-result-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-search .search-results .search-result-item .search-result-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-search .search-results .search-result-item .search-result-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-search .search-results .search-result-item .search-result-metadata{color:#9ca3af!important}
      body.dark-mode .sqs-block-search .search-results .search-result-item .search-result-metadata a{color:#60a5fa!important}
      body.dark-mode .sqs-block-search .search-results .search-result-item .search-result-metadata a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-comments .comment-item{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-comments .comment-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-comments .comment-item .comment-author{color:#f9fafb!important}
      body.dark-mode .sqs-block-comments .comment-item .comment-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-comments .comment-item .comment-metadata{color:#9ca3af!important}
      body.dark-mode .sqs-block-comments .comment-item .comment-metadata a{color:#60a5fa!important}
      body.dark-mode .sqs-block-comments .comment-item .comment-metadata a:hover{color:#93c5fd!important}
      body.dark-mode .sqs-block-comments .comment-form{background:transparent!important}
      body.dark-mode .sqs-block-comments .comment-form .comment-form-field{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-comments .comment-form .comment-form-field::placeholder{color:#9ca3af!important}
      body.dark-mode .sqs-block-comments .comment-form .comment-form-button{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .sqs-block-comments .comment-form .comment-form-button:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .sqs-block-table .table-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-table .table-wrapper table{background:transparent!important;border-color:#374151!important}
      body.dark-mode .sqs-block-table .table-wrapper table th{background:#1f2937!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-table .table-wrapper table td{background:transparent!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-table .table-wrapper table tr:hover td{background:#374151!important}
      body.dark-mode .sqs-block-table .table-wrapper table tr:nth-child(even) td{background:#1f2937!important}
      body.dark-mode .sqs-block-table .table-wrapper table tr:nth-child(even):hover td{background:#374151!important}
      body.dark-mode .sqs-block-chart .chart-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-chart .chart-wrapper .chart-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-chart .chart-wrapper .chart-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-tagcloud .tagcloud-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-tagcloud .tagcloud-wrapper .tagcloud-item{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-tagcloud .tagcloud-wrapper .tagcloud-item:hover{background:#4b5563!important;border-color:#6b7280!important;color:#60a5fa!important}
      body.dark-mode .sqs-block-divider .divider-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-divider .divider-wrapper .divider-line{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-spacer .spacer-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-shape .shape-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-shape .shape-wrapper svg{fill:#f9fafb!important;stroke:#f9fafb!important}
      body.dark-mode .sqs-block-animation .animation-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-audio .audio-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-audio .audio-wrapper .audio-player{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-audio .audio-wrapper .audio-player .audio-controls{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-audio .audio-wrapper .audio-player .audio-controls:hover{color:#60a5fa!important}
      body.dark-mode .sqs-block-audio .audio-wrapper .audio-player .audio-progress{background:#4b5563!important}
      body.dark-mode .sqs-block-audio .audio-wrapper .audio-player .audio-progress .audio-progress-bar{background:#3b82f6!important}
      body.dark-mode .sqs-block-audio .audio-wrapper .audio-player .audio-time{color:#9ca3af!important}
      body.dark-mode .sqs-block-map .map-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-controls{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-controls:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-marker{background:#3b82f6!important;border-color:#2563eb!important;color:#fff!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-marker:hover{background:#2563eb!important;border-color:#1d4ed8!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-popup{background:#1f2937!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-popup .map-popup-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-popup .map-popup-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-popup .map-popup-close{color:#9ca3af!important}
      body.dark-mode .sqs-block-map .map-wrapper .map-container .map-popup .map-popup-close:hover{color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper{background:transparent!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-header{background:#1f2937!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-header .calendar-nav{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-header .calendar-nav:hover{background:#374151!important;color:#60a5fa!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-header .calendar-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid{background:transparent!important;border-color:#374151!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day-header{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day{background:#1f2937!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.today{background:#3b82f6!important;border-color:#2563eb!important;color:#fff!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.today:hover{background:#2563eb!important;border-color:#1d4ed8!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.other-month{background:transparent!important;border-color:#374151!important;color:#6b7280!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.other-month:hover{background:#1f2937!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.has-events{background:#1f2937!important;border-color:#3b82f6!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.has-events:hover{background:#374151!important;border-color:#60a5fa!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.has-events .calendar-day-number{color:#3b82f6!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-grid .calendar-day.has-events:hover .calendar-day-number{color:#60a5fa!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events .calendar-event-item{background:transparent!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events .calendar-event-item:hover{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events .calendar-event-item .calendar-event-title{color:#f9fafb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events .calendar-event-item .calendar-event-content{color:#e5e7eb!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events .calendar-event-item .calendar-event-metadata{color:#9ca3af!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events .calendar-event-item .calendar-event-metadata a{color:#60a5fa!important}
      body.dark-mode .sqs-block-calendar .calendar-wrapper .calendar-events .calendar-event-item .calendar-event-metadata a:hover{color:#93c5fd!important}
      body.dark-mode .Header{background:#111827!important;border-color:#374151!important}
      body.dark-mode .Header-inner{background:#111827!important}
      body.dark-mode .Header-nav{background:transparent!important}
      body.dark-mode .Header-nav .Header-nav-item{background:transparent!important}
      body.dark-mode .Header-nav .Header-nav-item a{color:#f9fafb!important}
      body.dark-mode .Header-nav .Header-nav-item a:hover{color:#60a5fa!important}
      body.dark-mode .Header-nav .Header-nav-item.active a{color:#60a5fa!important}
      body.dark-mode .Header-nav .Header-nav-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Header-nav .Header-nav-item .Header-nav-submenu{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .Header-nav .Header-nav-item .Header-nav-submenu .Header-nav-submenu-item{background:transparent!important}
      body.dark-mode .Header-nav .Header-nav-item .Header-nav-submenu .Header-nav-submenu-item a{color:#f9fafb!important}
      body.dark-mode .Header-nav .Header-nav-item .Header-nav-submenu .Header-nav-submenu-item a:hover{color:#60a5fa!important;background:#374151!important}
      body.dark-mode .Header-nav .Header-nav-item .Header-nav-submenu .Header-nav-submenu-item.active a{color:#60a5fa!important}
      body.dark-mode .Header-nav .Header-nav-item .Header-nav-submenu .Header-nav-submenu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Header-logo{background:transparent!important}
      body.dark-mode .Header-logo img{opacity:0.95}
      body.dark-mode .Header-logo:hover img{opacity:1}
      body.dark-mode .Header-actions{background:transparent!important}
      body.dark-mode .Header-actions .Header-action{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .Header-actions .Header-action:hover{background:#374151!important;color:#60a5fa!important}
      body.dark-mode .Header-actions .Header-action.active{background:#3b82f6!important;color:#fff!important}
      body.dark-mode .Header-actions .Header-action.active:hover{background:#2563eb!important}
      body.dark-mode .Header-actions .Header-action .Header-action-icon{color:#f9fafb!important}
      body.dark-mode .Header-actions .Header-action:hover .Header-action-icon{color:#60a5fa!important}
      body.dark-mode .Header-actions .Header-action.active .Header-action-icon{color:#fff!important}
      body.dark-mode .Header-actions .Header-action.active:hover .Header-action-icon{color:#fff!important}
      body.dark-mode .Header-mobileNav{background:#111827!important;border-color:#374151!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-toggle{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-toggle:hover{background:#374151!important;color:#60a5fa!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item{background:transparent!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item a{color:#f9fafb!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item a:hover{color:#60a5fa!important;background:#374151!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item.active a{color:#60a5fa!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item .Header-mobileNav-submenu{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item .Header-mobileNav-submenu .Header-mobileNav-submenu-item{background:transparent!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item .Header-mobileNav-submenu .Header-mobileNav-submenu-item a{color:#f9fafb!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item .Header-mobileNav-submenu .Header-mobileNav-submenu-item a:hover{color:#60a5fa!important;background:#4b5563!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item .Header-mobileNav-submenu .Header-mobileNav-submenu-item.active a{color:#60a5fa!important}
      body.dark-mode .Header-mobileNav .Header-mobileNav-menu .Header-mobileNav-menu-item .Header-mobileNav-submenu .Header-mobileNav-submenu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Footer{background:#111827!important;border-color:#374151!important}
      body.dark-mode .Footer-inner{background:#111827!important}
      body.dark-mode .Footer-content{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .Footer-content a{color:#60a5fa!important}
      body.dark-mode .Footer-content a:hover{color:#93c5fd!important}
      body.dark-mode .Footer-nav{background:transparent!important}
      body.dark-mode .Footer-nav .Footer-nav-item{background:transparent!important}
      body.dark-mode .Footer-nav .Footer-nav-item a{color:#f9fafb!important}
      body.dark-mode .Footer-nav .Footer-nav-item a:hover{color:#60a5fa!important}
      body.dark-mode .Footer-nav .Footer-nav-item.active a{color:#60a5fa!important}
      body.dark-mode .Footer-nav .Footer-nav-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Footer-social{background:transparent!important}
      body.dark-mode .Footer-social .Footer-social-item{background:transparent!important}
      body.dark-mode .Footer-social .Footer-social-item a{color:#f9fafb!important}
      body.dark-mode .Footer-social .Footer-social-item a:hover{color:#60a5fa!important}
      body.dark-mode .Footer-social .Footer-social-item .Footer-social-icon{color:#f9fafb!important}
      body.dark-mode .Footer-social .Footer-social-item:hover .Footer-social-icon{color:#60a5fa!important}
      body.dark-mode .Footer-copyright{background:transparent!important;color:#9ca3af!important}
      body.dark-mode .Footer-copyright a{color:#60a5fa!important}
      body.dark-mode .Footer-copyright a:hover{color:#93c5fd!important}
      body.dark-mode .Site{background:#111827!important}
      body.dark-mode .Site-inner{background:#111827!important}
      body.dark-mode .Site-header{background:#111827!important}
      body.dark-mode .Site-header-inner{background:#111827!important}
      body.dark-mode .Site-header-nav{background:transparent!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item{background:transparent!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item a{color:#f9fafb!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item a:hover{color:#60a5fa!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item.active a{color:#60a5fa!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item .Site-header-nav-submenu{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item .Site-header-nav-submenu .Site-header-nav-submenu-item{background:transparent!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item .Site-header-nav-submenu .Site-header-nav-submenu-item a{color:#f9fafb!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item .Site-header-nav-submenu .Site-header-nav-submenu-item a:hover{color:#60a5fa!important;background:#374151!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item .Site-header-nav-submenu .Site-header-nav-submenu-item.active a{color:#60a5fa!important}
      body.dark-mode .Site-header-nav .Site-header-nav-item .Site-header-nav-submenu .Site-header-nav-submenu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Site-header-logo{background:transparent!important}
      body.dark-mode .Site-header-logo img{opacity:0.95}
      body.dark-mode .Site-header-logo:hover img{opacity:1}
      body.dark-mode .Site-header-actions{background:transparent!important}
      body.dark-mode .Site-header-actions .Site-header-action{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .Site-header-actions .Site-header-action:hover{background:#374151!important;color:#60a5fa!important}
      body.dark-mode .Site-header-actions .Site-header-action.active{background:#3b82f6!important;color:#fff!important}
      body.dark-mode .Site-header-actions .Site-header-action.active:hover{background:#2563eb!important}
      body.dark-mode .Site-header-actions .Site-header-action .Site-header-action-icon{color:#f9fafb!important}
      body.dark-mode .Site-header-actions .Site-header-action:hover .Site-header-action-icon{color:#60a5fa!important}
      body.dark-mode .Site-header-actions .Site-header-action.active .Site-header-action-icon{color:#fff!important}
      body.dark-mode .Site-header-actions .Site-header-action.active:hover .Site-header-action-icon{color:#fff!important}
      body.dark-mode .Site-header-mobileNav{background:#111827!important;border-color:#374151!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-toggle{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-toggle:hover{background:#374151!important;color:#60a5fa!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu{background:#1f2937!important;border-color:#374151!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item{background:transparent!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item a{color:#f9fafb!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item a:hover{color:#60a5fa!important;background:#374151!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item.active a{color:#60a5fa!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item .Site-header-mobileNav-submenu{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item .Site-header-mobileNav-submenu .Site-header-mobileNav-submenu-item{background:transparent!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item .Site-header-mobileNav-submenu .Site-header-mobileNav-submenu-item a{color:#f9fafb!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item .Site-header-mobileNav-submenu .Site-header-mobileNav-submenu-item a:hover{color:#60a5fa!important;background:#4b5563!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item .Site-header-mobileNav-submenu .Site-header-mobileNav-submenu-item.active a{color:#60a5fa!important}
      body.dark-mode .Site-header-mobileNav .Site-header-mobileNav-menu .Site-header-mobileNav-menu-item .Site-header-mobileNav-submenu .Site-header-mobileNav-submenu-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Site-footer{background:#111827!important}
      body.dark-mode .Site-footer-inner{background:#111827!important}
      body.dark-mode .Site-footer-content{background:transparent!important;color:#f9fafb!important}
      body.dark-mode .Site-footer-content a{color:#60a5fa!important}
      body.dark-mode .Site-footer-content a:hover{color:#93c5fd!important}
      body.dark-mode .Site-footer-nav{background:transparent!important}
      body.dark-mode .Site-footer-nav .Site-footer-nav-item{background:transparent!important}
      body.dark-mode .Site-footer-nav .Site-footer-nav-item a{color:#f9fafb!important}
      body.dark-mode .Site-footer-nav .Site-footer-nav-item a:hover{color:#60a5fa!important}
      body.dark-mode .Site-footer-nav .Site-footer-nav-item.active a{color:#60a5fa!important}
      body.dark-mode .Site-footer-nav .Site-footer-nav-item.active a:hover{color:#93c5fd!important}
      body.dark-mode .Site-footer-social{background:transparent!important}
      body.dark-mode .Site-footer-social .Site-footer-social-item{background:transparent!important}
      body.dark-mode .Site-footer-social .Site-footer-social-item a{color:#f9fafb!important}
      body.dark-mode .Site-footer-social .Site-footer-social-item a:hover{color:#60a5fa!important}
      body.dark-mode .Site-footer-social .Site-footer-social-item .Site-footer-social-icon{color:#f9fafb!important}
      body.dark-mode .Site-footer-social .Site-footer-social-item:hover .Site-footer-social-icon{color:#60a5fa!important}
      body.dark-mode .Site-footer-copyright{background:transparent!important;color:#9ca3af!important}
      body.dark-mode .Site-footer-copyright a{color:#60a5fa!important}
      body.dark-mode .Site-footer-copyright a:hover{color:#93c5fd!important}
      body.dark-mode h1,body.dark-mode h2,body.dark-mode h3,body.dark-mode h4,body.dark-mode h5,body.dark-mode h6{color:#f9fafb!important}
      body.dark-mode p{color:#e5e7eb!important}
      body.dark-mode a{color:#60a5fa!important}
      body.dark-mode a:hover{color:#93c5fd!important}
      body.dark-mode ul,body.dark-mode ol{color:#e5e7eb!important}
      body.dark-mode li{color:#e5e7eb!important}
      body.dark-mode blockquote{background:#1f2937!important;border-color:#374151!important;color:#e5e7eb!important}
      body.dark-mode code{background:#1f2937!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode pre{background:#1f2937!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode pre code{background:transparent!important;border-color:transparent!important;color:#f9fafb!important}
      body.dark-mode table{background:transparent!important;border-color:#374151!important}
      body.dark-mode table th{background:#1f2937!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode table td{background:transparent!important;border-color:#374151!important;color:#f9fafb!important}
      body.dark-mode table tr:hover td{background:#374151!important}
      body.dark-mode table tr:nth-child(even) td{background:#1f2937!important}
      body.dark-mode table tr:nth-child(even):hover td{background:#374151!important}
      body.dark-mode hr{background:#374151!important;border-color:#4b5563!important}
      body.dark-mode img{opacity:0.95}
      body.dark-mode img:hover{opacity:1}
      body.dark-mode svg{fill:#f9fafb!important;stroke:#f9fafb!important}
      body.dark-mode svg:hover{fill:#60a5fa!important;stroke:#60a5fa!important}
      body.dark-mode input[type="text"],body.dark-mode input[type="email"],body.dark-mode input[type="password"],body.dark-mode input[type="number"],body.dark-mode input[type="tel"],body.dark-mode input[type="url"],body.dark-mode input[type="search"],body.dark-mode input[type="date"],body.dark-mode input[type="time"],body.dark-mode input[type="datetime-local"],body.dark-mode input[type="month"],body.dark-mode input[type="week"],body.dark-mode textarea,body.dark-mode select{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode input[type="text"]::placeholder,body.dark-mode input[type="email"]::placeholder,body.dark-mode input[type="password"]::placeholder,body.dark-mode input[type="number"]::placeholder,body.dark-mode input[type="tel"]::placeholder,body.dark-mode input[type="url"]::placeholder,body.dark-mode input[type="search"]::placeholder,body.dark-mode input[type="date"]::placeholder,body.dark-mode input[type="time"]::placeholder,body.dark-mode input[type="datetime-local"]::placeholder,body.dark-mode input[type="month"]::placeholder,body.dark-mode input[type="week"]::placeholder,body.dark-mode textarea::placeholder{color:#9ca3af!important}
      body.dark-mode input[type="text"]:focus,body.dark-mode input[type="email"]:focus,body.dark-mode input[type="password"]:focus,body.dark-mode input[type="number"]:focus,body.dark-mode input[type="tel"]:focus,body.dark-mode input[type="url"]:focus,body.dark-mode input[type="search"]:focus,body.dark-mode input[type="date"]:focus,body.dark-mode input[type="time"]:focus,body.dark-mode input[type="datetime-local"]:focus,body.dark-mode input[type="month"]:focus,body.dark-mode input[type="week"]:focus,body.dark-mode textarea:focus,body.dark-mode select:focus{background:#4b5563!important;border-color:#60a5fa!important;color:#f9fafb!important;outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode input[type="checkbox"],body.dark-mode input[type="radio"]{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode input[type="checkbox"]:checked,body.dark-mode input[type="radio"]:checked{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode input[type="checkbox"]:focus,body.dark-mode input[type="radio"]:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode button{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode button:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode button:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode button.secondary{background:transparent!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode button.secondary:hover{background:#374151!important;border-color:#6b7280!important}
      body.dark-mode button.secondary:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode button.danger{background:#ef4444!important;border-color:#ef4444!important;color:#fff!important}
      body.dark-mode button.danger:hover{background:#dc2626!important;border-color:#dc2626!important}
      body.dark-mode button.danger:focus{outline:none!important;box-shadow:0 0 0 3px rgba(239,68,68,0.1)!important}
      body.dark-mode button.success{background:#10b981!important;border-color:#10b981!important;color:#fff!important}
      body.dark-mode button.success:hover{background:#059669!important;border-color:#059669!important}
      body.dark-mode button.success:focus{outline:none!important;box-shadow:0 0 0 3px rgba(16,185,129,0.1)!important}
      body.dark-mode button.warning{background:#f59e0b!important;border-color:#f59e0b!important;color:#fff!important}
      body.dark-mode button.warning:hover{background:#d97706!important;border-color:#d97706!important}
      body.dark-mode button.warning:focus{outline:none!important;box-shadow:0 0 0 3px rgba(245,158,11,0.1)!important}
      body.dark-mode button.info{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode button.info:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode button.info:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode button.link{background:transparent!important;border-color:transparent!important;color:#60a5fa!important}
      body.dark-mode button.link:hover{background:transparent!important;border-color:transparent!important;color:#93c5fd!important;text-decoration:underline}
      body.dark-mode button.link:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode .btn{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .btn:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .btn:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode .btn-secondary{background:transparent!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .btn-secondary:hover{background:#374151!important;border-color:#6b7280!important}
      body.dark-mode .btn-secondary:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode .btn-danger{background:#ef4444!important;border-color:#ef4444!important;color:#fff!important}
      body.dark-mode .btn-danger:hover{background:#dc2626!important;border-color:#dc2626!important}
      body.dark-mode .btn-danger:focus{outline:none!important;box-shadow:0 0 0 3px rgba(239,68,68,0.1)!important}
      body.dark-mode .btn-success{background:#10b981!important;border-color:#10b981!important;color:#fff!important}
      body.dark-mode .btn-success:hover{background:#059669!important;border-color:#059669!important}
      body.dark-mode .btn-success:focus{outline:none!important;box-shadow:0 0 0 3px rgba(16,185,129,0.1)!important}
      body.dark-mode .btn-warning{background:#f59e0b!important;border-color:#f59e0b!important;color:#fff!important}
      body.dark-mode .btn-warning:hover{background:#d97706!important;border-color:#d97706!important}
      body.dark-mode .btn-warning:focus{outline:none!important;box-shadow:0 0 0 3px rgba(245,158,11,0.1)!important}
      body.dark-mode .btn-info{background:#3b82f6!important;border-color:#3b82f6!important;color:#fff!important}
      body.dark-mode .btn-info:hover{background:#2563eb!important;border-color:#2563eb!important}
      body.dark-mode .btn-info:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode .btn-link{background:transparent!important;border-color:transparent!important;color:#60a5fa!important}
      body.dark-mode .btn-link:hover{background:transparent!important;border-color:transparent!important;color:#93c5fd!important;text-decoration:underline}
      body.dark-mode .btn-link:focus{outline:none!important;box-shadow:0 0 0 3px rgba(59,130,246,0.1)!important}
      body.dark-mode .ssa-controls{border-bottom-color:#374151!important}
      body.dark-mode .ssa-layout-btn{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-layout-btn:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-group-btn{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-group-btn:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-keyword-btn{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-keyword-btn:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-weekend-btn{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-weekend-btn:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-clear-dates{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-clear-dates:hover{background:#4b5563!important;border-color:#6b7280!important}
      body.dark-mode .ssa-date-input{background:#374151!important;border-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-date-filters label{color:#f9fafb!important}
      body.dark-mode .ssa-month-header{color:#f9fafb!important}
      body.dark-mode .ssa-day-header,body.dark-mode .ssa-day-header *,body.dark-mode #events-list .ssa-day-header,body.dark-mode #events-list .ssa-day-header *{color:#f9fafb!important}
      body.dark-mode h3.ssa-day-header,body.dark-mode h3.ssa-day-header *{color:#f9fafb!important}
      body.dark-mode .ssa-calendar-month-header{color:#f9fafb!important}
      body.dark-mode .ssa-event-item{background:#1f2937!important;border-color:#374151!important;box-shadow:0 1px 3px rgba(0,0,0,0.2)!important}
      body.dark-mode .ssa-event-item:hover{background:#374151!important;box-shadow:0 4px 12px rgba(0,0,0,0.3)!important}
      body.dark-mode .ssa-event-name-wrapper strong{color:#f9fafb!important}
      body.dark-mode .ssa-event-name{color:#f9fafb!important}
      body.dark-mode .ssa-event-name,.ssa-event-meta-item{color:#e5e7eb!important}
      body.dark-mode .ssa-event-meta-item,.ssa-event-meta-item *{color:#e5e7eb!important}
      body.dark-mode #events-list .ssa-event-meta-item,#events-list .ssa-event-meta-item *{color:#e5e7eb!important}
      body.dark-mode div.ssa-event-meta-item,div.ssa-event-meta-item *{color:#e5e7eb!important}
      body.dark-mode .ssa-event-meta-item strong{color:#f9fafb!important}
      body.dark-mode #events-list .ssa-event-meta-item strong,.ssa-event-meta-item strong *,#events-list .ssa-event-meta-item strong *{color:#f9fafb!important}
      body.dark-mode .ssa-card{background:#1f2937!important;border-color:#374151!important;box-shadow:0 2px 8px rgba(0,0,0,0.2)!important}
      body.dark-mode .ssa-card:hover{box-shadow:0 8px 24px rgba(0,0,0,0.4)!important;border-color:#4b5563!important}
      body.dark-mode .ssa-card *{color:#f9fafb!important}
      body.dark-mode .ssa-title,.ssa-meta{color:#f9fafb!important}
      body.dark-mode .ssa-card .ssa-location{color:#60a5fa!important}
      body.dark-mode .ssa-card .ssa-location:hover{color:#93c5fd!important}
      body.dark-mode .ssa-card h3{color:#f9fafb!important}
      body.dark-mode .ssa-card p{color:#f9fafb!important}
      body.dark-mode .ssa-card span{color:#f9fafb!important}
      body.dark-mode .ssa-card strong{color:#f9fafb!important}
      body.dark-mode .ssa-card a{color:#60a5fa!important}
      body.dark-mode .ssa-card a:hover{color:#93c5fd!important}
      body.dark-mode .ssa-calendar-day{background:#1f2937!important}
      body.dark-mode .ssa-calendar-day:hover{background:#374151!important}
      body.dark-mode .ssa-calendar-day-empty{background:#111827!important}
      body.dark-mode .ssa-calendar-day-out-of-range{opacity:0.3;background:#1f2937!important}
      body.dark-mode .ssa-calendar-day-out-of-range .ssa-calendar-day-number{color:#6b7280!important}
      body.dark-mode .ssa-calendar-day-header{background:#374151!important;color:#d1d5db!important}
      body.dark-mode .ssa-calendar-day-number{color:#f9fafb!important}
      body.dark-mode .ssa-calendar-grid{background:#374151!important;border-color:#374151!important;box-shadow:0 2px 8px rgba(0,0,0,0.3)!important}
      body.dark-mode .ssa-day-header{border-bottom-color:#4b5563!important;color:#f9fafb!important}
      body.dark-mode .ssa-day-header *,body.dark-mode #events-list .ssa-day-header,body.dark-mode #events-list .ssa-day-header *{color:#f9fafb!important}
      body.dark-mode h3.ssa-day-header,body.dark-mode h3.ssa-day-header *{color:#f9fafb!important}
      body.dark-mode .ssa-month-header{color:#f9fafb!important}
      body.dark-mode .ssa-calendar-month-header{color:#f9fafb!important}
    `;
    document.head.appendChild(css);
    
    // Inject additional dark mode styles with maximum specificity for Squarespace
    const sqsDarkModeCSS = document.createElement('style');
    sqsDarkModeCSS.id = 'ssa-sqs-dark-mode';
    sqsDarkModeCSS.textContent = `
      html.dark-mode,html body.dark-mode,body.dark-mode{background:#111827!important;color:#f9fafb!important}
      html.dark-mode body,html body.dark-mode body,body.dark-mode{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #siteWrapper,html body.dark-mode #siteWrapper,body.dark-mode #siteWrapper{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #site,html body.dark-mode #site,body.dark-mode #site{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #mainContent,html body.dark-mode #mainContent,body.dark-mode #mainContent{background:#111827!important;color:#f9fafb!important}
      html.dark-mode #content,html body.dark-mode #content,body.dark-mode #content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Main-content,html body.dark-mode .Main-content,body.dark-mode .Main-content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Main,html body.dark-mode .Main,body.dark-mode .Main{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Main-inner,html body.dark-mode .Main-inner,body.dark-mode .Main-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Content,html body.dark-mode .Content,body.dark-mode .Content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Content-inner,html body.dark-mode .Content-inner,body.dark-mode .Content-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .page,html body.dark-mode .page,body.dark-mode .page{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .page-content,html body.dark-mode .page-content,body.dark-mode .page-content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-layout,html body.dark-mode .sqs-layout,body.dark-mode .sqs-layout{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-wrapper,html body.dark-mode .sqs-wrapper,body.dark-mode .sqs-wrapper{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-container,html body.dark-mode .sqs-container,body.dark-mode .sqs-container{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Site,html body.dark-mode .Site,body.dark-mode .Site{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Site-inner,html body.dark-mode .Site-inner,body.dark-mode .Site-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Header,html body.dark-mode .Header,body.dark-mode .Header{background:#111827!important;color:#f9fafb!important;border-color:#374151!important}
      html.dark-mode .Header-inner,html body.dark-mode .Header-inner,body.dark-mode .Header-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Header-nav,html body.dark-mode .Header-nav,body.dark-mode .Header-nav{background:transparent!important}
      html.dark-mode .Header-nav-item,html body.dark-mode .Header-nav-item,body.dark-mode .Header-nav-item{background:transparent!important}
      html.dark-mode .Header-nav-item a,html body.dark-mode .Header-nav-item a,body.dark-mode .Header-nav-item a{color:#f9fafb!important}
      html.dark-mode .Header-nav-item a:hover,html body.dark-mode .Header-nav-item a:hover,body.dark-mode .Header-nav-item a:hover{color:#60a5fa!important}
      html.dark-mode .Header-logo,html body.dark-mode .Header-logo,body.dark-mode .Header-logo{background:transparent!important}
      html.dark-mode .Footer,html body.dark-mode .Footer,body.dark-mode .Footer{background:#111827!important;color:#f9fafb!important;border-color:#374151!important}
      html.dark-mode .Footer-inner,html body.dark-mode .Footer-inner,body.dark-mode .Footer-inner{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .Footer-nav,html body.dark-mode .Footer-nav,body.dark-mode .Footer-nav{background:transparent!important}
      html.dark-mode .Footer-nav-item,html body.dark-mode .Footer-nav-item,body.dark-mode .Footer-nav-item{background:transparent!important}
      html.dark-mode .Footer-nav-item a,html body.dark-mode .Footer-nav-item a,body.dark-mode .Footer-nav-item a{color:#f9fafb!important}
      html.dark-mode .Footer-nav-item a:hover,html body.dark-mode .Footer-nav-item a:hover,body.dark-mode .Footer-nav-item a:hover{color:#60a5fa!important}
      html.dark-mode .sqs-row,html body.dark-mode .sqs-row,body.dark-mode .sqs-row{background:transparent!important}
      html.dark-mode .sqs-col,html body.dark-mode .sqs-col,body.dark-mode .sqs-col{background:transparent!important}
      html.dark-mode .sqs-block,html body.dark-mode .sqs-block,body.dark-mode .sqs-block{background:transparent!important}
      html.dark-mode .sqs-block-content,html body.dark-mode .sqs-block-content,body.dark-mode .sqs-block-content{background:transparent!important}
      html.dark-mode .section,html body.dark-mode .section,body.dark-mode .section{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-section,html body.dark-mode .sqs-section,body.dark-mode .sqs-section{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-section-content,html body.dark-mode .sqs-section-content,body.dark-mode .sqs-section-content{background:#111827!important;color:#f9fafb!important}
      html.dark-mode .sqs-block-alignment-wrapper,html body.dark-mode .sqs-block-alignment-wrapper,body.dark-mode .sqs-block-alignment-wrapper{background:transparent!important}
      html.dark-mode .sqs-block-html,html body.dark-mode .sqs-block-html,body.dark-mode .sqs-block-html{background:transparent!important}
      html.dark-mode .sqs-block-code,html body.dark-mode .sqs-block-code,body.dark-mode .sqs-block-code{background:transparent!important}
      html.dark-mode .sqs-block-markdown,html body.dark-mode .sqs-block-markdown,body.dark-mode .sqs-block-markdown{background:transparent!important}
      html.dark-mode .sqs-block-embed,html body.dark-mode .sqs-block-embed,body.dark-mode .sqs-block-embed{background:transparent!important}
      html.dark-mode header,html body.dark-mode header,body.dark-mode header{background:#111827!important;color:#f9fafb!important}
      html.dark-mode footer,html body.dark-mode footer,body.dark-mode footer{background:#111827!important;color:#f9fafb!important}
      html.dark-mode nav,html body.dark-mode nav,body.dark-mode nav{background:transparent!important;color:#f9fafb!important}
      html.dark-mode nav a,html body.dark-mode nav a,body.dark-mode nav a{color:#f9fafb!important}
      html.dark-mode nav a:hover,html body.dark-mode nav a:hover,body.dark-mode nav a:hover{color:#60a5fa!important}
      html.dark-mode h1,html body.dark-mode h1,body.dark-mode h1,html.dark-mode h2,html body.dark-mode h2,body.dark-mode h2,html.dark-mode h3,html body.dark-mode h3,body.dark-mode h3,html.dark-mode h4,html body.dark-mode h4,body.dark-mode h4,html.dark-mode h5,html body.dark-mode h5,body.dark-mode h5,html.dark-mode h6,html body.dark-mode h6,body.dark-mode h6{color:#f9fafb!important}
      html.dark-mode p,html body.dark-mode p,body.dark-mode p{color:#e5e7eb!important}
      html.dark-mode a,html body.dark-mode a,body.dark-mode a{color:#60a5fa!important}
      html.dark-mode a:hover,html body.dark-mode a:hover,body.dark-mode a:hover{color:#93c5fd!important}
      html.dark-mode .ssa-day-header,html body.dark-mode .ssa-day-header,body.dark-mode .ssa-day-header{color:#f9fafb!important}
      html.dark-mode .ssa-day-header *,html body.dark-mode .ssa-day-header *,body.dark-mode .ssa-day-header *{color:#f9fafb!important}
      html.dark-mode #events-list .ssa-day-header,html body.dark-mode #events-list .ssa-day-header,body.dark-mode #events-list .ssa-day-header{color:#f9fafb!important}
      html.dark-mode #events-list .ssa-day-header *,html body.dark-mode #events-list .ssa-day-header *,body.dark-mode #events-list .ssa-day-header *{color:#f9fafb!important}
      html.dark-mode h3.ssa-day-header,html body.dark-mode h3.ssa-day-header,body.dark-mode h3.ssa-day-header{color:#f9fafb!important}
      html.dark-mode h3.ssa-day-header *,html body.dark-mode h3.ssa-day-header *,body.dark-mode h3.ssa-day-header *{color:#f9fafb!important}
      html.dark-mode .ssa-month-header,html body.dark-mode .ssa-month-header,body.dark-mode .ssa-month-header{color:#f9fafb!important}
      html.dark-mode .ssa-calendar-month-header,html body.dark-mode .ssa-calendar-month-header,body.dark-mode .ssa-calendar-month-header{color:#f9fafb!important}
      html.dark-mode div:not(.sqs-block):not(.sqs-block-content):not(.sqs-block-html):not(.sqs-block-code):not(.sqs-block-markdown):not(.sqs-block-embed),html body.dark-mode div:not(.sqs-block):not(.sqs-block-content):not(.sqs-block-html):not(.sqs-block-code):not(.sqs-block-markdown):not(.sqs-block-embed),body.dark-mode div:not(.sqs-block):not(.sqs-block-content):not(.sqs-block-html):not(.sqs-block-code):not(.sqs-block-markdown):not(.sqs-block-embed){background-color:inherit!important}
      html.dark-mode *,html body.dark-mode *{color:inherit}
    `;
    document.head.appendChild(sqsDarkModeCSS);
  }

  // Helper function to reload events when filters change
  async function reloadEvents(mount, state, opts) {
    if (!opts || !opts.url || !opts.key) {
      console.error('reloadEvents: Missing required opts (url, key)', opts);
      // Fallback: try to use existing rows and filter client-side
      const existingRows = mount._allRows || [];
      await renderEvents(mount, existingRows, state);
      return;
    }
    
    try {
      // ALWAYS fetch ALL events (no date filters) to ensure we have complete data for keyword extraction
      // Client-side filtering will handle date ranges - this avoids API filter complexity issues
      console.log('üîÑ reloadEvents: Fetching ALL events (no date filters)');
      const fetchOpts = {
        url: opts.url,
        key: opts.key,
        from: null,  // Explicitly null - fetch all events
        to: null,    // Explicitly null - fetch all events
        limit: opts.limit || 200
      };
      const key = `ssa_events:${opts.url}:all:${opts.limit||200}`;
      const rows = await fetchEvents(fetchOpts);
      mount._allRows = rows; // Store for fallback
      sessionStorage.setItem(key, JSON.stringify(rows));
      console.log('‚úÖ reloadEvents: Fetched', rows.length, 'events for keyword cloud');
      await renderEvents(mount, rows, state);
    } catch (e) {
      console.error('Error reloading events:', e);
      // Fallback: try to use existing rows and filter client-side
      const existingRows = mount._allRows || [];
      if (existingRows.length > 0) {
        await renderEvents(mount, existingRows, state);
      } else {
        mount.innerHTML = `<div class="ssa-empty">Sorry, events are unavailable right now.</div>`;
      }
    }
  }

  async function renderEventsWidget(opts) {
    const mount = document.querySelector(opts.mount);
    if (!mount) return;
    
    // Normalize initial keywords to lowercase for consistent comparison
    const normalizedKeywords = (opts.selectedKeywords || []).map(kw => (kw || '').toLowerCase().trim()).filter(kw => kw);
    
    // Initialize state - default fromDate to today
    const state = {
      layout: opts.layout || LAYOUTS.LIST,
      selectedKeywords: normalizedKeywords,
      fromDate: opts.fromDate !== undefined ? opts.fromDate : todayISO(),
      toDate: opts.toDate || null,
      showImages: opts.showImages !== undefined ? opts.showImages : false,
      showSignatureEventsOnly: opts.showSignatureEventsOnly !== undefined ? opts.showSignatureEventsOnly : false,
      groupBy: opts.groupBy || 'day'
    };
    
    // Store opts for reloadEvents
    mount._widgetOpts = opts;
    
    mount.innerHTML = `<div class="ssa-grid"><div class="ssa-skel"></div><div class="ssa-skel"></div><div class="ssa-skel"></div></div>`;
    
    try {
      // Fetch events with fromDate (or null if cleared)
      const fetchOpts = {
        ...opts,
        from: state.fromDate || null,
        to: state.toDate || null
      };
      const key = `ssa_events:${opts.url}:${fetchOpts.from || 'all'}:${fetchOpts.to || ''}:${opts.limit||200}`;
      const cached = sessionStorage.getItem(key);
      if (cached) {
        const cachedData = JSON.parse(cached);
        mount._allRows = cachedData; // Store for fallback in reloadEvents
        await renderEvents(mount, cachedData, state);
      }
      const rows = await fetchEvents(fetchOpts);
      mount._allRows = rows; // Store for fallback in reloadEvents
      sessionStorage.setItem(key, JSON.stringify(rows));
      await renderEvents(mount, rows, state);
      
      // Initialize pull-to-refresh after events are rendered
      initPullToRefresh(mount, opts, state);
    } catch (e) {
      console.error(e);
      mount.innerHTML = `<div class="ssa-empty">Sorry, events are unavailable right now.</div>`;
    }
  }
  
  // Pull-to-refresh functionality
  function initPullToRefresh(mount, opts, state) {
    // Prevent duplicate initialization
    if (mount._pullToRefreshInitialized) {
      return;
    }
    mount._pullToRefreshInitialized = true;
    
    let touchStartY = 0;
    let touchCurrentY = 0;
    let isPulling = false;
    let pullDistance = 0;
    const pullThreshold = 80; // Distance in pixels to trigger refresh
    
    // Create refresh indicator element - attach to body for page-level pull-to-refresh
    const refreshIndicator = document.createElement('div');
    refreshIndicator.className = 'ssa-pull-to-refresh';
    refreshIndicator.style.cssText = `
      position: fixed;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #3b82f6;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      opacity: 0;
      transition: opacity 0.2s, top 0.2s;
      pointer-events: none;
      z-index: 10000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    `;
    refreshIndicator.innerHTML = '‚Üª';
    document.body.appendChild(refreshIndicator);
    
    const handleTouchStart = function(e) {
      // Only start pull if we're at the top of the page
      if (window.scrollY === 0) {
        touchStartY = e.touches[0].clientY;
        isPulling = true;
      }
    };
    
    const handleTouchMove = function(e) {
      if (!isPulling) return;
      
      touchCurrentY = e.touches[0].clientY;
      pullDistance = touchCurrentY - touchStartY;
      
      // Only allow pulling down
      if (pullDistance > 0 && window.scrollY === 0) {
        // Prevent default scrolling while pulling
        e.preventDefault();
        
        // Update indicator position and opacity
        const progress = Math.min(pullDistance / pullThreshold, 1);
        refreshIndicator.style.top = `${pullDistance - 60}px`;
        refreshIndicator.style.opacity = progress;
        
        // Rotate icon based on pull distance
        const rotation = pullDistance >= pullThreshold ? 180 : pullDistance * 2;
        refreshIndicator.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
      } else {
        // Reset if pulling up or scrolled away from top
        resetPullState();
      }
    };
    
    const handleTouchEnd = async function(e) {
      if (!isPulling) return;
      
      if (pullDistance >= pullThreshold && window.scrollY === 0) {
        // Trigger refresh
        refreshIndicator.style.top = '20px';
        refreshIndicator.style.opacity = '1';
        
        // Clear cache and reload events
        const fetchOpts = {
          ...opts,
          from: state.fromDate || null,
          to: state.toDate || null
        };
        const key = `ssa_events:${opts.url}:${fetchOpts.from || 'all'}:${fetchOpts.to || ''}:${opts.limit||200}`;
        sessionStorage.removeItem(key);
        
        try {
          const rows = await fetchEvents(fetchOpts);
          mount._allRows = rows;
          sessionStorage.setItem(key, JSON.stringify(rows));
          
          // Reset flag so pull-to-refresh can be re-initialized after render
          mount._pullToRefreshInitialized = false;
          await renderEvents(mount, rows, state);
          
          // Re-initialize pull-to-refresh after re-render
          setTimeout(() => {
            initPullToRefresh(mount, opts, state);
          }, 100);
        } catch (error) {
          console.error('Error refreshing events:', error);
          resetPullState();
        }
      } else {
        resetPullState();
      }
    };
    
    const resetPullState = function() {
      isPulling = false;
      pullDistance = 0;
      refreshIndicator.style.top = '-60px';
      refreshIndicator.style.opacity = '0';
      refreshIndicator.style.transform = 'translateX(-50%) rotate(0deg)';
    };
    
    // Add touch event listeners to document for page-level pull-to-refresh
    document.addEventListener('touchstart', handleTouchStart, { passive: true });
    document.addEventListener('touchmove', handleTouchMove, { passive: false });
    document.addEventListener('touchend', handleTouchEnd, { passive: true });
    
    // Store handlers for cleanup
    mount._pullToRefreshHandlers = {
      touchstart: handleTouchStart,
      touchmove: handleTouchMove,
      touchend: handleTouchEnd,
      indicator: refreshIndicator
    };
  }

  // Dark mode toggle functionality
  function toggleDarkMode() {
    const body = document.body;
    const html = document.documentElement;
    const isDark = body.classList.toggle('dark-mode');
    html.classList.toggle('dark-mode', isDark);
    const button = document.querySelector('.ssa-dark-mode-toggle');
    
    if (button) {
      button.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    }
    
    localStorage.setItem('ssa-dark-mode', isDark ? 'true' : 'false');
  }
  
  function initDarkModeToggle() {
    // Attach event listener to existing toggle button in controls
    const button = document.querySelector('.ssa-dark-mode-toggle');
    if (button) {
      button.onclick = toggleDarkMode;
      
      // Check for saved preference and update button text
      const savedDarkMode = localStorage.getItem('ssa-dark-mode');
      if (savedDarkMode === 'true') {
        document.body.classList.add('dark-mode');
        document.documentElement.classList.add('dark-mode');
        button.textContent = '‚òÄÔ∏è Light Mode';
      }
    }
  }

  window.SSWidgets = window.SSWidgets || {};
  window.SSWidgets.renderEvents = renderEventsWidget;
})();
</script>

<!-- 2) Mount + init call -->
<div id="events-list"></div>
<script>
  SSWidgets.renderEvents({
    mount: '#events-list',
    url: 'https://ydftcebaftngcdjvxrgl.supabase.co',
    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkZnRjZWJhZnRuZ2NkanZ4cmdsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NDA5NDcsImV4cCI6MjA3NjExNjk0N30.8AlcsUMJSxBlua-ehaGLAn69bbORoMBdjM--MSxxXF0',
    //from: undefined,   // default = today (only ongoing/upcoming)
    //to: undefined,     // set like '2025-12-31' to cap the range if you want
    limit: 200
  });
</script>
